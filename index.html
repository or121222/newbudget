<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<script>
    window.onerror = function(message, source, lineno, colno, error) {
        alert("×©×’×™××” ×‘××¤×œ×™×§×¦×™×”:\n" + message + "\n×©×•×¨×”: " + lineno);
    };
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Neto</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4e54c8">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="icon-192.png">

    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>

    <style>
        /* === CSS VARIABLES & THEMES === */
        :root {
            --bg-color: #f0f2f5;
            --card-bg: rgba(255, 255, 255, 0.95);
            --text-main: #2d3436;
            --text-sec: #636e72;
            --glass-border: 1px solid rgba(255, 255, 255, 0.6);
            --shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            --safe-area-top: env(safe-area-inset-top, 20px);
            
            /* Default Theme */
            --primary: #4e54c8;
            --secondary: #8f94fb;
            --danger: #ff7675;
            --success: #00b894;
        }

        /* Dark Mode */
        body.dark-mode {
            --bg-color: #1e272e;
            --card-bg: rgba(45, 52, 54, 0.95);
            --text-main: #dfe6e9;
            --text-sec: #b2bec3;
            --glass-border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Themes Override */
        body.theme-ocean { --primary: #006994; --secondary: #48cae4; --success: #0ead69; }
        body.theme-forest { --primary: #2d6a4f; --secondary: #52b788; --success: #40916c; }
        body.theme-sunset { --primary: #f77f00; --secondary: #fcbf49; --success: #d62828; }
        body.theme-luxury { --primary: #1a1a1a; --secondary: #d4af37; --success: #c9a227; }
        body.dark-mode.theme-luxury { --bg-color: #000; --card-bg: rgba(30,30,30,0.95); }

        /* General Styles */
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { font-family: 'Rubik', sans-serif; background-color: var(--bg-color); color: var(--text-main); padding-bottom: 100px; user-select: none; overflow-x: hidden; transition: background-color 0.3s; }
        
        /* Animations */
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .animate-item { animation: slideUp 0.3s ease-out forwards; }

        /* RTL/LTR Support */
        html[dir="ltr"] body { direction: ltr; }
        html[dir="ltr"] .menu-btn { right: auto; left: 20px; }
        html[dir="ltr"] .side-menu { right: auto; left: -280px; }
        html[dir="ltr"] .side-menu.open { right: auto; left: 0; }
        html[dir="ltr"] .month-arrow i { transform: rotate(180deg); }
        html[dir="ltr"] .total-balance { direction: ltr; }
        html[dir="ltr"] .cat-info { flex-direction: row; }
        html[dir="ltr"] .header-inputs, html[dir="ltr"] .filter-bar, html[dir="ltr"] .quick-add { direction: ltr; }
        html[dir="ltr"] .qa-row { flex-direction: row; }
        html[dir="ltr"] .ssc-table th, html[dir="ltr"] .ssc-table td { text-align: left; }
        html[dir="ltr"] .fab { left: auto; right: 20px; }
        html[dir="ltr"] .cat-delete-main-btn { left: auto; right: 10px; }
        html[dir="ltr"] .drag-handle { left: auto; right: 10px; }
        html[dir="ltr"] .card-header { padding-left: 15px; padding-right: 45px; } 
        html[dir="ltr"] .chart-toggle { right: auto; left: 10px; }
        html[dir="ltr"] .ssc-del-cat { left: auto; right: 8px; }
        html[dir="ltr"] .pin-cancel-btn { right: auto; left: 20px; }
        html[dir="ltr"] .conv-arrow-icon { transform: rotate(180deg); }

        /* Pages */
        .page { display: none; animation: fadeIn 0.3s ease; padding-bottom: 80px; }
        .page.active { display: block; }

        /* Header */
        header.app-header { background: linear-gradient(135deg, var(--primary), var(--secondary)); padding: calc(var(--safe-area-top) + 15px) 20px 30px 20px; border-bottom-left-radius: 40px; border-bottom-right-radius: 40px; color: white; text-align: center; box-shadow: 0 10px 30px rgba(78, 84, 200, 0.4); margin-bottom: 20px; position: relative; transition: background 0.3s; }
        .menu-btn { position: fixed; top: 50px; right: 20px; background: linear-gradient(135deg, var(--primary), var(--secondary)); border: none; color: white; width: 45px; height: 45px; border-radius: 50%; font-size: 1.2rem; cursor: pointer; z-index: 1200; box-shadow: 0 4px 10px rgba(0,0,0,0.2); display: flex; align-items: center; justify-content: center; transition: transform 0.3s; }
        body.no-scroll { overflow: hidden; }
        .menu-btn:active { transform: scale(0.9); }

        /* Dashboard Elements */
        .total-balance { font-size: 3rem; font-weight: 700; direction: ltr; margin: 5px 0 5px 0; text-shadow: 0 4px 10px rgba(0,0,0,0.15); }
        .left-to-spend { font-size: 0.9rem; opacity: 0.9; margin-bottom: 15px; direction: ltr; background: rgba(255,255,255,0.2); padding: 4px 12px; border-radius: 20px; display: inline-block; }
        .month-selector { display: flex; justify-content: center; align-items: center; gap: 20px; font-size: 1.3rem; font-weight: 600; color: white; margin-bottom: 20px; }
        .month-arrow { background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white; font-size: 1rem; padding: 8px 12px; border-radius: 20px; cursor: pointer; backdrop-filter: blur(4px); }
        .header-inputs { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        .h-input-box { background: rgba(255, 255, 255, 0.15); border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 15px; padding: 10px; backdrop-filter: blur(5px); text-align: center; }
        .h-input-box label { font-size: 0.8rem; opacity: 0.9; display: block; margin-bottom: 2px; }
        .h-input-box input { width: 100%; background: transparent; border: none; text-align: center; font-size: 1.2rem; font-weight: bold; color: white; }
        .h-input-box input::placeholder { color: rgba(255,255,255,0.6); }
        .motivation-box { background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 12px; padding: 10px 15px; margin-top: 10px; backdrop-filter: blur(4px); min-height: 40px; display: flex; align-items: center; justify-content: center; }
        .motivation-text { color: rgba(255,255,255,0.95); font-size: 1rem; font-style: italic; }

        /* Search & Filter */
        .search-container { padding: 0 15px 15px 15px; position: relative; }
        .search-input { width: 100%; padding: 12px 40px 12px 15px; border-radius: 25px; border: none; background: rgba(0,0,0,0.05); color: var(--text-main); font-size: 1rem; }
        .search-icon { position: absolute; top: 12px; left: 25px; color: var(--text-sec); }
        .filter-bar { display: flex; gap: 10px; padding: 0 15px; margin-bottom: 15px; justify-content: flex-end; }
        .filter-select { background: var(--card-bg); border: 1px solid rgba(0,0,0,0.1); padding: 8px; border-radius: 10px; font-size: 0.9rem; color: var(--text-main); }

        /* Side Menu */
        .side-menu-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; opacity: 0; pointer-events: none; transition: 0.3s; }
        .side-menu-overlay.open { opacity: 1; pointer-events: all; }
        .side-menu { position: fixed; top: 0; right: -280px; bottom: 0; width: 280px; background: var(--card-bg); z-index: 1001; transition: 0.3s; padding: 100px 20px 20px 20px; box-shadow: -5px 0 15px rgba(0,0,0,0.1); display: flex; flex-direction: column; gap: 5px; overflow-y: auto; max-height: 100vh; }
        .side-menu.open { right: 0; }
        .side-menu::-webkit-scrollbar { width: 6px; }
        .side-menu::-webkit-scrollbar-thumb { background-color: rgba(0,0,0,0.1); border-radius: 3px; }
        .menu-item { display: flex; align-items: center; gap: 15px; padding: 12px 15px; border-radius: 12px; color: var(--text-main); font-weight: 500; font-size: 1.05rem; cursor: pointer; transition: 0.2s; flex-shrink: 0; }
        .menu-item:hover { background: rgba(0,0,0,0.05); }
        .menu-item.active { background: var(--primary); color: white; }

        /* Category Card */
        .category-card { background: var(--card-bg); border-radius: 15px; box-shadow: var(--shadow); border: var(--glass-border); overflow: hidden; backdrop-filter: blur(10px); position: relative; margin-bottom: 15px; }
        .card-header { padding: 15px; padding-left: 45px; display: flex; justify-content: space-between; align-items: center; cursor: default; }
        .drag-handle { position: absolute; top: 40px; left: 10px; width: 24px; height: 24px; color: #b2bec3; display: flex; align-items: center; justify-content: center; cursor: grab; font-size: 1.2rem; z-index: 10; touch-action: none; }
        .cat-delete-main-btn { position: absolute; top: 10px; left: 10px; width: 24px; height: 24px; background: rgba(255, 118, 117, 0.15); color: var(--danger); border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 0.8rem; z-index: 10; }
        .cat-info { display: flex; align-items: center; gap: 10px; }
        .cat-emoji { background: rgba(100,100,100,0.1); width: 40px; height: 40px; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 1.4rem; }
        .cat-limit { font-size: 0.8rem; color: var(--text-sec); text-decoration: underline; cursor: pointer; background: rgba(0,0,0,0.05); padding: 2px 6px; border-radius: 4px; }
        .current-spend { font-size: 1.1rem; font-weight: bold; direction: ltr; }
        .progress-track { height: 6px; background: rgba(0,0,0,0.05); margin: 0 15px 10px 15px; border-radius: 3px; overflow: hidden; }
        .progress-fill { height: 100%; transition: width 0.5s ease; border-radius: 3px; }
        .bg-green { background: var(--success); } .bg-yellow { background: var(--warning); } .bg-red { background: var(--danger); }
        .items-list { list-style: none; border-top: 1px solid rgba(0,0,0,0.05); }
        .item-row { display: flex; justify-content: space-between; padding: 12px 15px; border-bottom: 1px solid rgba(0,0,0,0.03); font-size: 0.95rem; }
        .amount-pos { color: var(--success); font-weight: bold; } .amount-neg { color: var(--danger); font-weight: bold; }
        .pay-method-icon { margin-left: 8px; font-size: 0.8rem; color: var(--text-sec); }
        .quick-add { padding: 15px; background: rgba(0,0,0,0.02); display: flex; flex-direction: column; gap: 10px; }
        .qa-row { display: flex; gap: 10px; }
        .qa-input { padding: 12px; border-radius: 10px; border: 1px solid rgba(0,0,0,0.1); background: var(--card-bg); color: var(--text-main); font-size: 1rem; flex: 1; min-width: 0; }
        .qa-btn { background: var(--text-main); color: var(--bg-color); border: none; width: 100%; padding: 12px; border-radius: 10px; font-weight: bold; font-size: 1rem; display: flex; justify-content: center; align-items: center; gap: 5px; }

        /* Recurrring & Tools */
        .recur-add-box { background: var(--card-bg); padding: 20px; margin: 15px; border-radius: 15px; box-shadow: var(--shadow); }
        .rec-type-selector { display: flex; gap: 15px; margin-bottom: 15px; justify-content: center; background: rgba(0,0,0,0.03); padding: 10px; border-radius: 10px; }
        .rec-type-label { display: flex; align-items: center; gap: 8px; cursor: pointer; font-weight: 500; font-size: 0.95rem; }
        .rec-type-label input { accent-color: var(--primary); transform: scale(1.2); }
        
        .converter-box { background: var(--card-bg); border-radius: 20px; padding: 25px; margin: 20px; box-shadow: var(--shadow); border: var(--glass-border); text-align: center; display: flex; flex-direction: column; gap: 15px; }
        .conv-label { text-align: start; font-size: 0.9rem; color: var(--text-sec); margin-bottom: 5px; font-weight: 500; }
        .conv-input { width: 100%; padding: 15px; border-radius: 12px; border: 1px solid rgba(0,0,0,0.1); background: rgba(0,0,0,0.02); font-size: 1.5rem; color: var(--text-main); font-weight: bold; text-align: center; outline: none; }
        .conv-select { width: 100%; padding: 15px; border-radius: 12px; border: 1px solid rgba(0,0,0,0.1); background: var(--bg-color); font-size: 1rem; color: var(--text-main); appearance: none; }
        .conv-swap-container { display: flex; justify-content: center; align-items: center; margin: -5px 0; z-index: 5; }
        .conv-swap-btn { width: 45px; height: 45px; border-radius: 50%; background: var(--primary); color: white; border: 2px solid var(--card-bg); display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.2); font-size: 1.2rem; transition: transform 0.2s; }
        .conv-swap-btn:active { transform: scale(0.9); }
        .conv-result { margin-top: 10px; padding: 20px; background: linear-gradient(135deg, var(--primary), var(--secondary)); color: white; border-radius: 15px; }
        .conv-res-big { font-size: 2.2rem; font-weight: bold; direction: ltr; }
        .conv-res-sub { font-size: 0.9rem; opacity: 0.8; margin-top: 5px; direction: ltr; }

        .tool-card { background: var(--card-bg); border-radius: 20px; padding: 20px; margin: 15px; box-shadow: var(--shadow); border: var(--glass-border); }
        .tool-row { margin-bottom: 15px; }
        .tool-label { display: block; margin-bottom: 5px; color: var(--text-sec); font-size: 0.9rem; }
        .tool-input { width: 100%; padding: 12px; border-radius: 10px; border: 1px solid rgba(0,0,0,0.1); background: var(--bg-color); color: var(--text-main); font-size: 1.1rem; }
        .tool-result { margin-top: 20px; padding: 15px; background: rgba(0,0,0,0.03); border-radius: 10px; text-align: center; }
        .tool-res-val { font-size: 1.8rem; font-weight: bold; color: var(--primary); margin-top: 5px; direction: ltr; }
        
        .wishlist-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; background: var(--card-bg); margin-bottom: 10px; border-radius: 12px; box-shadow: var(--shadow); border: var(--glass-border); }
        .w-info { flex: 1; }
        .w-name { font-weight: bold; font-size: 1.1rem; }
        .w-price { color: var(--text-sec); font-size: 0.9rem; margin-top: 3px; }
        .w-actions { display: flex; gap: 10px; }
        .w-btn { width: 35px; height: 35px; border-radius: 50%; display: flex; align-items: center; justify-content: center; border: none; cursor: pointer; color: white; transition: transform 0.1s; }
        .w-btn:active { transform: scale(0.9); }
        .w-btn.buy { background: var(--success); }
        .w-btn.del { background: var(--danger); opacity: 0.8; }

        .savings-container { max-width: 800px; margin: 20px auto; padding: 0 15px; }
        .saving-card { color: white; border-radius: 15px; padding: 15px; margin-bottom: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); position: relative; }
        .saving-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .saving-progress-bg { background: rgba(255,255,255,0.3); height: 8px; border-radius: 4px; overflow: hidden; }
        .saving-progress-fill { background: white; height: 100%; width: 0%; transition: 0.5s; }
        
        .chart-container-card { max-width: 800px; margin: 20px auto; padding: 0 15px; }
        .chart-wrapper { background: var(--card-bg); border-radius: 15px; box-shadow: var(--shadow); border: var(--glass-border); padding: 15px; height: 320px; position: relative; }
        .chart-toggle { position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.05); border: none; padding: 5px 10px; border-radius: 8px; font-size: 0.8rem; cursor: pointer; z-index: 10; }

        .btn-primary { width: 100%; background: var(--primary); color: white; border: none; padding: 12px; border-radius: 10px; font-weight: bold; margin-top: 10px; cursor: pointer; transition: transform 0.1s; }
        .btn-primary:active { transform: scale(0.98); }
        .ad-spacer { height: 60px; width: 100%; display: block; }
        .fab { position: fixed; bottom: 20px; left: 20px; background: var(--primary); color: white; width: 60px; height: 60px; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 1.8rem; box-shadow: 0 4px 15px rgba(78, 84, 200, 0.5); cursor: pointer; border: none; z-index: 95; transition: transform 0.2s; }
        .fab:active { transform: scale(0.9); }

        /* Lock Screen */
        #pin-lock-screen { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: var(--bg-color); z-index: 20000; display: none; flex-direction: column; align-items: center; justify-content: center; padding: 20px; text-align: center; }
        #pin-lock-screen.active { display: flex; }
        .pin-cancel-btn { position: absolute; top: 40px; right: 20px; background: transparent; border: none; font-size: 1.5rem; color: var(--text-sec); cursor: pointer; padding: 10px; display: none; }
        .pin-title { margin-bottom: 20px; font-size: 1.5rem; color: var(--text-main); font-weight: bold; }
        .pin-subtitle { margin-bottom: 30px; color: var(--text-sec); font-size: 1rem; min-height: 20px; }
        .pin-dots { display: flex; gap: 15px; margin-bottom: 40px; }
        .pin-dot { width: 15px; height: 15px; border-radius: 50%; border: 2px solid var(--primary); transition: 0.2s; }
        .pin-dot.filled { background: var(--primary); }
        .pin-dot.error { border-color: var(--danger); background: var(--danger); animation: shake 0.3s; }
        .numpad { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; max-width: 300px; width: 100%; }
        .num-btn { background: var(--card-bg); border: var(--glass-border); color: var(--text-main); font-size: 1.5rem; font-weight: 500; height: 70px; border-radius: 35px; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: var(--shadow); transition: 0.1s; }
        .num-btn:active { transform: scale(0.95); background: rgba(0,0,0,0.05); }
        .num-btn.dummy { visibility: hidden; pointer-events: none; }
        
        /* Landing */
        #page-landing { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(135deg, var(--primary), var(--secondary)); z-index: 9999; display: none; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 30px; color: white; padding-bottom: 0; }
        #page-landing.active { display: flex; }
        .landing-logo { margin-bottom: 20px; animation: float 3s ease-in-out infinite; }
        .landing-title { font-size: 3.5rem; font-weight: 800; margin-bottom: 5px; letter-spacing: 2px; }
        .landing-subtitle { font-size: 1.2rem; opacity: 0.9; margin-bottom: 40px; font-weight: 300; }
        .landing-tip-card { background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.3); padding: 20px; border-radius: 20px; margin-bottom: 40px; max-width: 100%; width: 320px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .landing-tip-title { font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px; opacity: 0.8; margin-bottom: 10px; }
        .landing-tip-text { font-size: 1.1rem; font-style: italic; line-height: 1.5; }
        .btn-start-app { background: white; color: var(--primary); font-size: 1.4rem; font-weight: 700; padding: 18px 60px; border-radius: 50px; border: none; cursor: pointer; box-shadow: 0 10px 25px rgba(0,0,0,0.2); transition: transform 0.2s, box-shadow 0.2s; display: flex; align-items: center; gap: 10px; margin-bottom: 30px; }
        .btn-start-app:active { transform: scale(0.95); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }

        /* Switches & Settings */
        .lang-toggle-container { display: flex; gap: 15px; margin-top: 10px; justify-content: center; }
        .lang-mini-btn { background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.4); color: white; padding: 8px 16px; border-radius: 20px; font-size: 0.9rem; cursor: pointer; backdrop-filter: blur(4px); transition: 0.2s; display: flex; align-items: center; gap: 6px; }
        .lang-mini-btn:hover { background: rgba(255,255,255,0.3); transform: scale(1.05); }
        .lang-mini-btn.active { background: white; color: var(--primary); font-weight: bold; border-color: white; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .side-menu .lang-toggle-container { margin-bottom: 5px; }
        .side-menu .lang-mini-btn { color: var(--text-main); border-color: rgba(0,0,0,0.1); background: rgba(0,0,0,0.05); }
        .side-menu .lang-mini-btn.active { background: var(--primary); color: white; }
        
        .theme-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .theme-btn { padding: 10px; border-radius: 10px; border: 1px solid rgba(0,0,0,0.1); cursor: pointer; text-align: center; font-weight: 500; font-size: 0.9rem; color: white; transition: transform 0.1s; }
        .theme-btn:active { transform: scale(0.95); }
        
        .switch-container { display: flex; justify-content: space-between; align-items: center; background: rgba(0,0,0,0.05); padding: 10px 15px; border-radius: 10px; margin-bottom: 10px; }
        .switch-label { font-weight: 500; }
        .switch-toggle { position: relative; display: inline-block; width: 40px; height: 24px; }
        .switch-toggle input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 24px; }
        .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--primary); }
        input:checked + .slider:before { transform: translateX(16px); }
        
        .color-opt { width: 40px; height: 40px; border-radius: 50%; cursor: pointer; border: 3px solid transparent; transition: 0.2s; }
        .color-opt.selected { border-color: #333; transform: scale(1.1); box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        
        /* Modals */
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 2000; display: flex; justify-content: center; align-items: center; padding: 20px; opacity: 0; pointer-events: none; transition: 0.3s; }
        .modal-overlay.open { opacity: 1; pointer-events: all; }
        .modal-card { background: var(--bg-color); width: 100%; max-width: 400px; padding: 25px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); text-align: center; }

        /* SSC */
        .ssc-wrap { padding: 15px; font-family:"Rubik", sans-serif; color: var(--text-main); }
        .ssc-header-container { text-align: center; margin-top: 40px; margin-bottom: 20px; display: flex; flex-direction: column; align-items: center; gap: 15px; }
        .ssc-glass-badge { background: rgba(255,255,255,0.2); color: #fff; padding: 6px 16px; border: 1px solid rgba(255,255,255,0.3); border-radius: 20px; font-size: 0.9rem; font-weight: 500; backdrop-filter: blur(5px); }
        .ssc-glass-btn { background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 6px 16px; border-radius: 20px; font-size: 0.9rem; font-weight: 500; cursor: pointer; backdrop-filter: blur(5px); display: inline-flex; align-items: center; gap: 6px; transition: 0.2s; }
        .ssc-panel { background: var(--card-bg); border: var(--glass-border); border-radius: 16px; padding: 20px; box-shadow: var(--shadow); margin-bottom: 16px; backdrop-filter: blur(10px); }
        .ssc-row { display:flex; flex-wrap:wrap; gap:12px; align-items:end; margin-bottom: 10px; }
        .ssc-inp { appearance:none; border: 1px solid rgba(0,0,0,0.1); background: rgba(255,255,255,0.8); padding: 12px; border-radius: 12px; font-size: 1rem; outline:none; transition:.2s; width: 100%; color: var(--text-main); }
        .ssc-btn { border:none; padding:10px 16px; border-radius:12px; font-weight:600; cursor:pointer; transition:.2s; font-size:14px; display:inline-flex; align-items:center; justify-content:center; gap:6px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .ssc-btn.acc { background:var(--success); color:#fff; } .ssc-btn.ghost { background:transparent; border: 1px solid var(--glass-border); color: var(--text-sec); }
        .ssc-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(150px,1fr)); gap:12px; }
        .ssc-card { background: var(--card-bg); border: var(--glass-border); border-radius: 16px; padding: 16px; box-shadow: var(--shadow); display:flex; flex-direction:column; gap:10px; position:relative; }
        .ssc-del-cat { position:absolute; top:8px; left:8px; width: 24px; height: 24px; border-radius: 50%; background: rgba(255, 118, 117, 0.1); color: var(--danger); border:none; cursor:pointer; display:flex; align-items:center; justify-content:center; font-size: 12px; }
        .ssc-counter { display:flex; gap:8px; align-items:center; justify-content:space-between; background: rgba(0,0,0,0.03); padding:6px; border-radius: 12px; margin-top: auto; }
        .ssc-count { font-size:1.2rem; font-weight:700; min-width:30px; text-align:center; color: var(--primary); }
        .ssc-iconbtn { background:#fff; width:34px; height:34px; border-radius:10px; font-size:1.2rem; cursor:pointer; display:flex; align-items:center; justify-content:center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); color: var(--text-sec); }
        .ssc-summary { display:grid; grid-template-columns: 1fr 1fr 1fr; gap:10px; background: linear-gradient(135deg, #fff, #f9f9f9); border: var(--glass-border); border-radius:16px; padding:20px; box-shadow: var(--shadow); text-align: center; }
        .ssc-total { font-size:1.4rem; font-weight:800; color: var(--primary); margin-top: 5px; }
        .ssc-table { width:100%; border-collapse:collapse; margin-top:10px; border-radius:10px; overflow:hidden; font-size: 0.9rem; }
        .ssc-table th { background: rgba(78, 84, 200, 0.1); color: var(--primary); padding:12px; text-align:right; font-weight:600; }
        .ssc-table td { padding:12px; border-bottom:1px solid rgba(0,0,0,0.05); text-align:right; }
        .ssc-editor-slice { display:flex; gap:8px; margin-bottom:8px; align-items:flex-end; background: rgba(0,0,0,0.02); padding: 10px; border-radius: 10px; }
        .ssc-btn-close-slice { width: 30px; height: 30px; border-radius: 50%; background: #fff; border: 1px solid #eee; color: var(--danger); display: flex; align-items: center; justify-content: center; cursor: pointer; margin-bottom: 2px; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-10px); } 75% { transform: translateX(10px); } }
    </style>
</head>
<body>

    <div id="pin-lock-screen">
        <button id="pin-cancel-btn" class="pin-cancel-btn" onclick="cancelPinSetup()"><i class="fas fa-times"></i></button>
        <div class="pin-title" id="pin-title">×”×–×Ÿ ×§×•×“ ×’×™×©×”</div>
        <div class="pin-subtitle" id="pin-subtitle">×›×“×™ ×œ×”×™×›× ×¡ ×œ××¤×œ×™×§×¦×™×”</div>
        <div class="pin-dots">
            <div class="pin-dot"></div><div class="pin-dot"></div><div class="pin-dot"></div><div class="pin-dot"></div>
        </div>
        <div class="numpad">
            <div class="num-btn" onclick="pressPin(1)">1</div><div class="num-btn" onclick="pressPin(2)">2</div><div class="num-btn" onclick="pressPin(3)">3</div>
            <div class="num-btn" onclick="pressPin(4)">4</div><div class="num-btn" onclick="pressPin(5)">5</div><div class="num-btn" onclick="pressPin(6)">6</div>
            <div class="num-btn" onclick="pressPin(7)">7</div><div class="num-btn" onclick="pressPin(8)">8</div><div class="num-btn" onclick="pressPin(9)">9</div>
            <div class="num-btn dummy"></div><div class="num-btn" onclick="pressPin(0)">0</div><div class="num-btn" onclick="deletePin()"><i class="fas fa-backspace"></i></div>
        </div>
    </div>

    <div id="page-landing" class="page active">
        <div class="landing-logo">
            <img src="icon-192.png" alt="Logo" style="width: 120px; height: 120px; border-radius: 25px; box-shadow: 0 10px 25px rgba(0,0,0,0.2);">
        </div>
        
        <div class="landing-title" data-lang="app_title">Neto</div>
        <div class="landing-subtitle" data-lang="subtitle">× ×™×”×•×œ ×ª×§×¦×™×‘ ×—×›× ×•×¤×©×•×˜</div>
        
        <div class="landing-tip-card">
            <div class="landing-tip-title"><i class="fas fa-lightbulb"></i> <span data-lang="daily_tip">×˜×™×¤ ×™×•××™</span></div>
            <div class="landing-tip-text" id="landing-tip-text">...</div>
        </div>

        <button class="btn-start-app" onclick="navTo('dashboard')">
            <span data-lang="start_btn">×‘×•××• × ×ª×—×™×œ</span> 
            <i class="fas fa-arrow-left" id="start-arrow"></i>
        </button>
<button class="btn-start-app" style="background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.5); margin-top: -15px;" onclick="window.location.href='clock.html'">
    <i class="fas fa-stopwatch"></i> ×©×¢×•×Ÿ × ×•×›×—×•×ª
</button>
        <div class="lang-toggle-container">
            <button class="lang-mini-btn" onclick="setLanguage('he')" data-lang-btn="he">
                <span>ğŸ‡®ğŸ‡±</span> <span>×¢×‘×¨×™×ª</span>
            </button>
            <button class="lang-mini-btn" onclick="setLanguage('en')" data-lang-btn="en">
                <span>ğŸ‡ºğŸ‡¸</span> <span>English</span>
            </button>
        </div>
    </div>

    <button class="menu-btn" onclick="toggleMenu()"><i class="fas fa-bars"></i></button>

    <div id="menu-overlay" class="side-menu-overlay" onclick="toggleMenu()"></div>
    
    <div id="side-menu" class="side-menu">
        <h2 style="color:var(--primary); padding:0 20px;" data-lang="menu_title">×ª×¤×¨×™×˜</h2>
        <div class="menu-item" onclick="window.location.href='clock.html'">
    <i class="fas fa-stopwatch"></i> <span data-lang="menu_timer">×©×¢×•×Ÿ × ×•×›×—×•×ª</span>
</div>
        <div class="menu-item active" onclick="navTo('dashboard')"><i class="fas fa-home"></i> <span data-lang="menu_home">×¨××©×™</span></div>
        <div class="menu-item" onclick="navTo('recurring')"><i class="fas fa-sync-alt"></i> <span data-lang="menu_recur">×”×•×¦××•×ª ×§×‘×•×¢×•×ª</span></div>
        <div class="menu-item" onclick="navTo('converter')"><i class="fas fa-exchange-alt"></i> <span data-lang="menu_converter">×××™×¨ ××˜×‘×¢×•×ª</span></div>
        <div class="menu-item" onclick="navTo('calc')"><i class="fas fa-calculator"></i> <span data-lang="menu_calc">××—×©×‘×•×Ÿ ×©×›×¨</span></div>
        <div class="menu-item" onclick="navTo('loan')"><i class="fas fa-hand-holding-usd"></i> <span data-lang="menu_loan">××—×©×‘×•×Ÿ ×”×œ×•×•××”</span></div>
        <div class="menu-item" onclick="navTo('split')"><i class="fas fa-utensils"></i> <span data-lang="menu_split">×¤×™×¦×•×œ ×—×©×‘×•×Ÿ</span></div>
        <div class="menu-item" onclick="navTo('wishlist')"><i class="fas fa-gift"></i> <span data-lang="menu_wishlist">××©××œ×•×ª</span></div>
        <div class="menu-item" onclick="navTo('premium')"><i class="fas fa-star"></i> <span data-lang="menu_pro">×¤×¨×™××™×•×</span></div>
        
        <div class="menu-divider" style="height:1px;background:rgba(0,0,0,0.1);margin:5px 0;"></div>
        
        <div class="menu-item" onclick="openSettingsModal()"><i class="fas fa-cog"></i> <span data-lang="menu_backup">×”×’×“×¨×•×ª</span></div>
        <div class="menu-item" onclick="toggleDarkMode()"><i class="fas fa-moon"></i> <span data-lang="menu_dark">××¦×‘ ×œ×™×œ×”</span></div>
        <div class="menu-item" onclick="setupPinCode()"><i class="fas fa-lock"></i> <span data-lang="setup_pin">×”×’×“×¨×ª ×§×•×“ × ×¢×™×œ×”</span></div>
        <div class="menu-item" onclick="removePinCode()"><i class="fas fa-unlock"></i> <span data-lang="remove_pin">×”×¡×¨ ×§×•×“ × ×¢×™×œ×”</span></div>
        
        <div class="menu-divider" style="height:1px;background:rgba(0,0,0,0.1);margin:5px 0;"></div>
        
        <div class="lang-toggle-container">
            <button class="lang-mini-btn" onclick="setLanguage('he')" data-lang-btn="he">ğŸ‡®ğŸ‡± ×¢×‘×¨×™×ª</button>
            <button class="lang-mini-btn" onclick="setLanguage('en')" data-lang-btn="en">ğŸ‡ºğŸ‡¸ English</button>
        </div>
        
        <div class="menu-divider" style="height:1px;background:rgba(0,0,0,0.1);margin:5px 0;"></div>
        
        <div style="text-align:center; opacity:0.7; font-size:0.75rem; margin-bottom:2px;">××˜×‘×¢ / Currency</div>
        <div class="lang-toggle-container" style="margin-bottom: 10px;">
            <button class="lang-mini-btn" onclick="setCurrency('ILS')" data-curr-btn="ILS">â‚ª</button>
            <button class="lang-mini-btn" onclick="setCurrency('USD')" data-curr-btn="USD">$</button>
            <button class="lang-mini-btn" onclick="setCurrency('EUR')" data-curr-btn="EUR">â‚¬</button>
        </div>
    </div>

    <div id="page-dashboard" class="page">
        <header class="app-header">
            <div style="height:20px"></div>
            <div style="font-weight:700" data-lang="app_title">Neto</div>
            <div class="month-selector">
                <button class="month-arrow" onclick="changeMonth(-1)"><i class="fas fa-chevron-right"></i></button>
                <span id="current-month-display">--</span>
                <button class="month-arrow" onclick="changeMonth(1)"><i class="fas fa-chevron-left"></i></button>
            </div>
            <div class="total-balance" id="global-balance">â‚ª0.00</div>
            <div class="left-to-spend" id="left-to-spend" data-lang="left_to_spend">...</div>
            <div class="header-inputs">
                <div class="h-input-box"><label data-lang="balance_label">×¢×•"×© ×‘×‘× ×§</label><input type="number" id="bank-input" placeholder="0" oninput="saveAndRender()"></div>
                <div class="h-input-box"><label data-lang="salary_label">××©×›×•×¨×ª</label><input type="number" id="salary-input" placeholder="0" oninput="updateSalary()"></div>
            </div>
            <div class="motivation-box"><i class="fas fa-quote-right" style="margin-left:5px; opacity:0.8"></i><span class="motivation-text" id="motivation-text">...</span></div>
        </header>

        <div class="search-container">
            <i class="fas fa-search search-icon"></i>
            <input type="text" id="search-bar" class="search-input" data-lang-placeholder="search_ph" placeholder="×—×™×¤×•×©..." oninput="renderApp()">
        </div>

        <div class="filter-bar">
            <select id="cat-filter" class="filter-select" onchange="renderApp()"><option value="all" data-lang="filter_all">×›×œ ×”×§×˜×’×•×¨×™×•×ª</option></select>
        </div>

        <div id="categories-container"></div>
        
        <div class="savings-container">
            <h3 style="margin-bottom:10px; color:var(--text-main)"><i class="fas fa-piggy-bank"></i> <span data-lang="savings_title">×§×•×¤×•×ª ×—×™×¡×›×•×Ÿ</span></h3>
            <div id="savings-list"></div>
            <button class="btn-primary" style="background:var(--success); margin-top:5px;" onclick="openGoalModal()" data-lang="new_goal_btn">+ ×™×¢×“ ×—×“×©</button>
        </div>

        <div class="chart-container-card">
            <div class="chart-wrapper">
                <button class="chart-toggle" onclick="toggleChartType()"><i class="fas fa-exchange-alt"></i> <span data-lang="chart_toggle">×”×—×œ×£ ×ª×¦×•×’×”</span></button>
                <div style="position: relative; height: 100%; width: 100%;">
                    <canvas id="expenseChart"></canvas>
                </div>
            </div>
        </div>
        <div style="text-align:center; font-size:12px; color:#888; margin-top: 20px; padding-bottom: 100px;" data-lang="footer_rights">
            Â© All rights reserved for Neto App
        </div>
        <div class="ad-spacer"></div>
        <button class="fab" onclick="openCategoryModal()"><i class="fas fa-plus"></i></button>
    </div>

    <div id="page-converter" class="page">
        <header class="app-header" style="padding-bottom: 20px;">
            <div style="height:20px"></div>
            <h2 data-lang="menu_converter">×××™×¨ ××˜×‘×¢×•×ª</h2>
        </header>
        <div class="converter-box">
            <div><div class="conv-label" data-lang="amount_placeholder">×¡×›×•×</div><input type="number" id="conv-amount" class="conv-input" value="1" placeholder="1" oninput="convertCurrency()"></div>
            <div><div class="conv-label">×××˜×‘×¢ / From</div><select id="conv-from" class="conv-select" onchange="convertCurrency()"></select></div>
            <div class="conv-swap-container"><button class="conv-swap-btn" onclick="swapCurrencies()"><i class="fas fa-arrow-down conv-arrow-icon"></i></button></div>
            <div><div class="conv-label">×œ××˜×‘×¢ / To</div><select id="conv-to" class="conv-select" onchange="convertCurrency()"></select></div>
            <div class="conv-result"><div class="conv-res-big" id="conv-result-big">---</div><div class="conv-res-sub" id="conv-result-sub"></div></div>
            <div style="font-size:0.7rem; opacity:0.5; margin-top:5px;">Rates by ExchangeRate-API</div>
        </div>
        <div class="ad-spacer"></div>
    </div>

    <div id="page-recurring" class="page">
        <header class="app-header" style="padding-bottom: 20px;">
            <div style="height:20px"></div>
            <h2 data-lang="recur_title">×”×•×¦××•×ª ×§×‘×•×¢×•×ª</h2>
        </header>
        
        <div class="recur-add-box">
            <h3 style="margin-top:0; color:var(--primary); margin-bottom:15px;" data-lang="add_new">+ ×”×•×¡×¤×” ×—×“×©×”</h3>
            
            <div class="rec-type-selector">
                <label class="rec-type-label">
                    <input type="radio" name="recType" id="type-fixed" value="fixed" checked onchange="toggleRecType()">
                    <span data-lang="type_fixed">×”×•×¨××ª ×§×‘×¢</span>
                </label>
                <label class="rec-type-label">
                    <input type="radio" name="recType" id="type-installments" value="installments" onchange="toggleRecType()">
                    <span data-lang="type_installments">×ª×©×œ×•××™×</span>
                </label>
            </div>

            <div style="display:flex; gap:5px;">
                <input type="text" id="rec-desc" class="qa-input" style="flex:2; min-width:0;" data-lang-placeholder="recur_name_ph" placeholder="×©×">
                <input type="number" id="rec-amount" class="qa-input" style="flex:1; min-width:0;" data-lang-placeholder="amount_placeholder" placeholder="×¡×›×•×">
            </div>
            
            <div id="rec-payments-container" style="display:none; margin-top:10px;">
                <input type="number" id="rec-payments" class="qa-input" style="width:100%;" data-lang-placeholder="num_payments" placeholder="××¡×¤×¨ ×ª×©×œ×•××™×">
            </div>

            <select id="rec-cat-select" class="qa-input" style="width:100%; margin-top:10px; margin-bottom:10px;"></select>
            <button class="btn-primary" onclick="addRecurringSetting()" style="width: 50%; margin: 10px auto; display: block;" data-lang="save_order">×©××•×¨ ×”×•×¨××”</button>
        </div>

        <div class="ssc-panel" style="margin: 0 15px;">
            <h3 style="margin-top:0; margin-bottom:10px; color:var(--text-main);" data-lang="active_orders">×¨×©×™××ª ×”×•×¨××•×ª ×¤×¢×™×œ×•×ª</h3>
            <div style="overflow-x:auto;">
                <table class="ssc-table" style="width:100%;">
                    <thead><tr><th style="width:30%" data-lang="col_name">×©×</th><th style="width:30%" data-lang="col_cat">×§×˜×’×•×¨×™×”</th><th style="text-align:center" data-lang="col_amount">×¡×›×•×</th><th style="text-align:center" data-lang="col_del">××—×§</th></tr></thead>
                    <tbody id="recurring-list-container"></tbody>
                </table>
            </div>
        </div>
        <div class="ad-spacer"></div>
    </div>

    <div id="page-calc" class="page">
        <header class="app-header" style="padding-bottom: 40px; border-bottom-left-radius: 40px; border-bottom-right-radius: 40px;">
            <div style="height:20px"></div>
            <div class="ssc-header-container" style="margin: 0; color:white;">
                <h2 style="margin:0; font-size:3rem; font-weight:700;" data-lang="calc_title">×—×™×©×•×‘ ×©×›×¨</h2>
                <div class="ssc-controls-row">
                    <span id="ssc_modeBadge" class="ssc-glass-badge" data-lang="mode_free">××¦×‘ ×¢×¨×™×›×” ×—×•×¤×©×™</span>
                    <button class="ssc-glass-btn" onclick="sscResetMonth()"><i class="fas fa-sync-alt"></i> <span data-lang="reset">××™×¤×•×¡</span></button>
                </div>
            </div>
        </header>
        <div class="ssc-wrap" style="margin-top: -20px;">
            <section class="ssc-panel">
                <div class="ssc-row"><label style="flex:1"><small data-lang="hourly_wage">×©×›×¨ ×œ×©×¢×”</small><input id="ssc_hourly" type="number" step="0.1" placeholder="0" class="ssc-inp"></label><label style="flex:1"><small data-lang="month">×—×•×“×©</small><input id="ssc_month" type="month" class="ssc-inp"></label></div>
            </section>
            <section class="ssc-panel" id="ssc_editorPanel">
                <h3 style="margin-top:0;color:var(--primary)" data-lang="add_shift_title">×”×•×¡×¤×ª ×¡×•×’ ××©××¨×ª</h3>
                <input type="text" id="ssc_newShiftName" data-lang-placeholder="shift_name_ph" placeholder="×©×" class="ssc-inp" style="margin-bottom:10px;">
                <div id="ssc_newShiftSlices"></div>
                <div style="display:flex; justify-content:space-between; margin-top:10px;"><button class="ssc-btn ghost" onclick="sscAddEditorSlice()" style="font-size:12px;" data-lang="add_step">+ ×”×•×¡×£ ××“×¨×’×”</button><button class="ssc-btn acc" id="ssc_saveTemplateBtn" data-lang="save_type">×©××•×¨ ×¡×•×’</button></div>
            </section>
            <section class="ssc-panel" style="background:transparent; border:none; padding:0; box-shadow:none;">
                <div class="ssc-grid" id="ssc_grid"></div>
                <div id="ssc_emptyState" style="text-align:center;padding:40px;color:#999;font-size:14px; background:rgba(255,255,255,0.5); border-radius:16px;" data-lang="no_shifts">××™×Ÿ ××©××¨×•×ª ××•×’×“×¨×•×ª</div>
            </section>
            <div class="ssc-summary" style="margin-top:20px">
                <div><div class="ssc-meta" data-lang="stat_shifts">××©××¨×•×ª</div><div class="ssc-total" id="ssc_totalShifts">0</div></div>
                <div><div class="ssc-meta" data-lang="stat_hours">×©×¢×•×ª</div><div class="ssc-total" id="ssc_totalHours">0</div></div>
                <div><div class="ssc-meta" data-lang="stat_wage">×©×›×¨</div><div class="ssc-total" id="ssc_grandTotal" style="color:var(--success)">â‚ª0</div></div>
            </div>
            <div class="ssc-panel" style="margin-top:16px">
                <div style="font-weight:700;margin-bottom:12px; color:var(--text-main);" data-lang="free_calc_title">××—×©×‘×•×Ÿ ×—×•×¤×©×™ (×ª×•×¡×¤×•×ª)</div>
                <div style="display:flex; gap:10px; margin-bottom:5px; font-size:0.8rem; color:var(--text-sec); padding:0 5px;"><span style="flex:2" data-lang="col_desc">×ª×™××•×¨</span><span style="flex:1; text-align:center" data-lang="col_hours">×©×¢×•×ª</span><span style="flex:1; text-align:center" data-lang="col_percent">××—×•×– %</span><span style="width:30px"></span></div>
                <div id="ssc_quickRows"></div>
                <div class="ssc-row" style="margin-top:12px"><button class="ssc-btn acc" onclick="sscAddQuickRow()" style="font-size:12px; width:100%;" data-lang="add_row">+ ×”×•×¡×£ ×©×•×¨×”</button></div>
                <div style="text-align:left; margin-top:10px; font-weight:bold; color:var(--text-sec);"><span data-lang="total_additions">×¡×”×´×› ×ª×•×¡×¤×•×ª:</span> <span id="ssc_quickSum">0</span></div>
            </div>
            <section class="ssc-panel">
                <h3 style="margin-bottom:10px; color:var(--text-main);" data-lang="full_details">×¤×™×¨×•×˜ ××œ×</h3>
                <div style="overflow-x:auto"><table class="ssc-table"><thead><tr><th data-lang="col_type">×¡×•×’</th><th data-lang="col_qty">×›××•×ª</th><th data-lang="col_hours">×©×¢×•×ª</th><th data-lang="col_total">×¡×”×´×›</th></tr></thead><tbody id="ssc_details"></tbody><tfoot><tr><td colspan="3" data-lang="grand_total">×¡×”×´×› ×›×•×œ×œ</td><td id="ssc_detailsTotal">0</td></tr></tfoot></table></div>
            </section>
            
            <div style="display:flex; justify-content:center; gap:5px; margin-top:20px; opacity:0.3;">
                <input type="text" id="ssc_secretCode" class="ssc-inp" placeholder="×§×•×“..." style="width:100px; text-align:center; padding:8px;">
                <button class="ssc-btn" id="ssc_secretBtn" style="background:#999; color:white;">OK</button>
            </div>
        </div>
        <div class="ad-spacer"></div>
    </div>

    <div id="page-loan" class="page">
        <header class="app-header" style="padding-bottom: 20px;">
            <div style="height:20px"></div>
            <h2 data-lang="menu_loan">××—×©×‘×•×Ÿ ×”×œ×•×•××”</h2>
        </header>
        <div class="tool-card">
            <div class="tool-row"><label class="tool-label" data-lang="loan_amount">×¡×›×•× ×”×”×œ×•×•××”</label><input type="number" id="loan-amount" class="tool-input"></div>
            <div class="tool-row"><label class="tool-label" data-lang="loan_interest">×¨×™×‘×™×ª ×©× ×ª×™×ª (%)</label><input type="number" id="loan-rate" class="tool-input"></div>
            <div class="tool-row"><label class="tool-label" data-lang="loan_years">×ª×§×•×¤×” (×©× ×™×)</label><input type="number" id="loan-years" class="tool-input"></div>
            <button class="btn-primary" onclick="calcLoan()" data-lang="calculate">×—×©×‘</button>
            <div class="tool-result">
                <div style="font-size:0.9rem;" data-lang="monthly_payment">×”×—×–×¨ ×—×•×“×©×™</div>
                <div class="tool-res-val" id="loan-result">---</div>
            </div>
        </div>
        <div class="ad-spacer"></div>
    </div>

    <div id="page-split" class="page">
        <header class="app-header" style="padding-bottom: 20px;">
            <div style="height:20px"></div>
            <h2 data-lang="menu_split">×¤×™×¦×•×œ ×—×©×‘×•×Ÿ</h2>
        </header>
        <div class="tool-card">
            <div class="tool-row"><label class="tool-label" data-lang="bill_amount">×¡×›×•× ×”×—×©×‘×•×Ÿ</label><input type="number" id="split-amount" class="tool-input"></div>
            <div class="tool-row"><label class="tool-label" data-lang="tip_percent">×˜×™×¤ (%)</label><input type="number" id="split-tip" class="tool-input" value="10"></div>
            <div class="tool-row"><label class="tool-label" data-lang="num_people">××¡×¤×¨ ×× ×©×™×</label><input type="number" id="split-people" class="tool-input" value="2"></div>
            <button class="btn-primary" onclick="calcSplit()" data-lang="calculate">×—×©×‘</button>
            <div class="tool-result">
                <div style="font-size:0.9rem;" data-lang="total_per_person">×¡×”×´×› ×œ××“×</div>
                <div class="tool-res-val" id="split-result">---</div>
            </div>
        </div>
        <div class="ad-spacer"></div>
    </div>

    <div id="page-wishlist" class="page">
        <header class="app-header" style="padding-bottom: 20px;">
            <div style="height:20px"></div>
            <h2 data-lang="menu_wishlist">×¨×©×™××ª ××©××œ×•×ª</h2>
            <div class="motivation-box" style="margin-top: 15px;">
                <i class="fas fa-star" style="margin-left:5px; opacity:0.8"></i>
                <span class="motivation-text" style="font-weight:bold;" data-lang="wishlist_tip">×œ×¤× ×™ ×©×§×•× ×™× - ×—×•×©×‘×™× ×¤×¢××™×™×! ğŸ’­</span> 
            </div>
        </header>
        <div class="recur-add-box">
            <h3 style="margin-top:0; color:var(--primary); margin-bottom:15px;" data-lang="add_new">+ ×”×•×¡×¤×” ×—×“×©×”</h3>
            <div style="display:flex; gap:5px;">
                <input type="text" id="wish-name" class="qa-input" style="flex:2; min-width:0;" data-lang-placeholder="item_name" placeholder="×©× ××•×¦×¨">
                <input type="number" id="wish-price" class="qa-input" style="flex:1; min-width:0;" data-lang-placeholder="item_price" placeholder="××—×™×¨">
            </div>
            <button class="btn-primary" onclick="addWishlistItem()" style="width: 50%; margin: 10px auto; display: block;" data-lang="add">×”×•×¡×£</button>
        </div>
        <div style="padding: 0 15px;" id="wishlist-container"></div>
        <div class="ad-spacer"></div>
    </div>

    <div id="page-premium" class="page">
        <header class="app-header" style="padding-bottom: 20px;">
            <div style="height:20px"></div>
            <h2 data-lang="premium_title">Premium</h2>
        </header>
        <div id="premium-content" style="padding: 20px; text-align: center;">
            <div style="background: linear-gradient(135deg, #FFD700, #FDB931); padding:30px; border-radius:20px; color:#333; box-shadow:0 10px 20px rgba(0,0,0,0.1);">
                <h1><i class="fas fa-crown"></i></h1>
                <h2 data-lang="upgrade_pro">×©×“×¨×•×’ ×œ×¤×¨×•</h2>
                <p data-lang="pro_desc">×”×¡×¨×ª ×¤×¨×¡×•××•×ª, ×’×™×‘×•×™ ×‘×¢× ×Ÿ ×•×ª××™×›×”.</p>
                <button class="btn-primary" style="background:#bdc3c7; margin-top:20px; cursor:not-allowed;" disabled data-lang="coming_soon">×‘×§×¨×•×‘</button>
            </div>
        </div>
    </div>

    <div id="settings-modal" class="modal-overlay">
        <div class="modal-card">
            <h3 data-lang="settings_title">×”×’×“×¨×•×ª</h3>
            
            <div style="text-align:start; margin-bottom:5px; font-size:0.9rem; font-weight:bold; color:var(--text-sec);">×¢×¨×›×ª × ×•×©×</div>
            <div class="theme-grid">
                <div class="theme-btn" style="background:#4e54c8" onclick="applyTheme('default')">×¡×’×•×œ</div>
                <div class="theme-btn" style="background:#006994" onclick="applyTheme('ocean')">×™×</div>
                <div class="theme-btn" style="background:#2d6a4f" onclick="applyTheme('forest')">×™×¢×¨</div>
                <div class="theme-btn" style="background:#f77f00" onclick="applyTheme('sunset')">×©×§×™×¢×”</div>
            </div>

            <div style="margin-top:15px; margin-bottom:5px; font-weight:bold; font-size:0.9rem; color:var(--text-sec);">×ª××¨×™×š ×ª×—×™×œ×ª ×—×•×“×© (××—×–×•×¨ ×—×™×•×‘)</div>
            <div class="switch-container" style="flex-direction:column; align-items:stretch; gap:10px;">
                <div style="display:flex; justify-content:space-between;">
                     <span>×™×•× ×‘×—×•×“×©: <span id="bill-day-val" style="font-weight:bold; color:var(--primary);">1</span></span>
                </div>
                <input type="range" id="billing-day-slider" min="1" max="31" value="1" style="width:100%" oninput="updateBillingDayVal()" onchange="saveBillingDay()">
            </div>

            <div class="switch-container">
                <span class="switch-label">×¨×˜×˜ ×‘××’×¢</span>
                <label class="switch-toggle">
                    <input type="checkbox" id="haptic-toggle" onchange="toggleHaptic()">
                    <span class="slider"></span>
                </label>
            </div>

            <hr style="margin: 15px 0; border:0; border-top:1px solid rgba(0,0,0,0.1);">

            <button class="btn-primary" onclick="exportDataJSON()" style="margin-bottom:10px; background:var(--primary)"><i class="fas fa-share-alt"></i> <span data-lang="backup_btn">×’×™×‘×•×™ ××œ× (×©×ª×£)</span></button>
            <label class="btn-primary" style="background:var(--secondary); display:block; cursor:pointer; margin-bottom:10px"><i class="fas fa-file-import"></i> <span data-lang="restore_btn">×©×—×–×•×¨ ××’×™×‘×•×™</span><input type="file" onchange="importDataJSON(this)" style="display:none"></label>
<button class="btn-primary" onclick="exportToCSV()" style="margin-bottom:10px; background:var(--success)">
    <i class="fas fa-file-csv"></i> <span data-lang="export_btn">×™×™×¦×•× ×œ××§×¡×œ (×©×ª×£)</span>
</button>
            <button class="btn-primary" style="background:#ccc; color:#333; margin-top:10px" onclick="toggleMenu(); document.getElementById('settings-modal').classList.remove('open')" data-lang="close">×¡×’×•×¨</button>
        </div>
    </div>
    
    <div id="delete-category-modal" class="modal-overlay">
        <div class="modal-card" style="text-align:center;">
            <i class="fas fa-exclamation-triangle" style="font-size:3rem; color:var(--danger); margin-bottom:15px;"></i>
            <h3 style="margin-bottom:10px;" data-lang="delete_cat_title">×œ××—×•×§ ××ª ×”×§×˜×’×•×¨×™×”?</h3>
            <p style="margin-bottom:20px; color:#666; font-size:0.95rem;" data-lang="delete_cat_msg">×”×§×˜×’×•×¨×™×” ×•×›×œ ×”×”×•×¦××•×ª ×™×™××—×§×•.\n×œ× × ×™×ª×Ÿ ×œ×©×—×–×¨!</p>
            <input type="hidden" id="delete-cat-target-id">
            <div style="display:flex; gap:10px; justify-content:center;">
                <button class="btn-primary" style="background:#ccc; color:#333; width:auto; padding:10px 25px;" onclick="closeDeleteCatModal()" data-lang="cancel">×‘×™×˜×•×œ</button>
                <button class="btn-primary" style="background:var(--danger); width:auto; padding:10px 25px;" onclick="performCategoryDelete()" data-lang="yes_delete">×›×Ÿ, ××—×§</button>
            </div>
        </div>
    </div>

    <div id="goal-modal" class="modal-overlay">
        <div class="modal-card">
            <h3 data-lang="new_goal_title">×™×¢×“ ×—×™×¡×›×•×Ÿ ×—×“×©</h3>
            <div style="display:flex; gap:10px; margin-bottom:15px;">
                <input type="text" id="new-goal-emoji" class="qa-input" style="width:60px; text-align:center;" value="âœˆï¸" data-lang-placeholder="icon_ph" placeholder="×¡××œ">
                <input type="text" id="new-goal-name" class="qa-input" style="flex:1;" data-lang-placeholder="goal_name_ph" placeholder="×©× ×”×™×¢×“">
            </div>
            <input type="number" id="new-goal-target" class="qa-input" style="width:100%; margin-bottom:15px" data-lang-placeholder="goal_target_ph" placeholder="×¡×›×•× ×™×¢×“">
            <label style="display:block; margin-bottom:8px; font-size:0.9rem;" data-lang="choose_color">×‘×—×¨ ×¦×‘×¢:</label>
            <div class="color-picker-row" style="display:flex; gap:10px; justify-content:center; margin-bottom:20px;">
                <div class="color-opt selected" onclick="selectGoalColor(this, 'linear-gradient(135deg, #a8e063, #56ab2f)')" style="background: linear-gradient(135deg, #a8e063, #56ab2f);"></div>
                <div class="color-opt" onclick="selectGoalColor(this, 'linear-gradient(135deg, #ff9966, #ff5e62)')" style="background: linear-gradient(135deg, #ff9966, #ff5e62);"></div>
                <div class="color-opt" onclick="selectGoalColor(this, 'linear-gradient(135deg, #56CCF2, #2F80ED)')" style="background: linear-gradient(135deg, #56CCF2, #2F80ED);"></div>
                <div class="color-opt" onclick="selectGoalColor(this, 'linear-gradient(135deg, #834d9b, #d04ed6)')" style="background: linear-gradient(135deg, #834d9b, #d04ed6);"></div>
            </div>
            <input type="hidden" id="new-goal-color" value="linear-gradient(135deg, #a8e063, #56ab2f)">
            <div style="display:flex; gap:10px;"><button class="btn-primary" style="background:#ccc; color:#333" onclick="document.getElementById('goal-modal').classList.remove('open')" data-lang="cancel">×‘×™×˜×•×œ</button><button class="btn-primary" onclick="confirmAddGoal()" data-lang="save">×©××•×¨</button></div>
        </div>
    </div>

    <div id="deposit-modal" class="modal-overlay">
        <div class="modal-card">
            <h3 data-lang="deposit_title">×”×¤×§×“×” ×œ×™×¢×“</h3>
            <p id="deposit-goal-name" style="margin-bottom:15px; opacity:0.7;">...</p>
            <input type="number" id="deposit-amount" class="qa-input" style="width:100%; margin-bottom:15px" data-lang-placeholder="deposit_amount_ph" placeholder="×¡×›×•× ×œ×”×¤×§×“×”">
            <input type="hidden" id="deposit-goal-index">
            <div style="display:flex; gap:10px;"><button class="btn-primary" style="background:#ccc; color:#333" onclick="document.getElementById('deposit-modal').classList.remove('open')" data-lang="cancel">×‘×™×˜×•×œ</button><button class="btn-primary" onclick="confirmDeposit()" data-lang="deposit_btn">×”×¤×§×“</button></div>
        </div>
    </div>

    <div id="delete-confirm-modal" class="modal-overlay">
        <div class="modal-card" style="text-align:center;">
            <i class="fas fa-exclamation-circle" style="font-size:3rem; color:var(--danger); margin-bottom:10px;"></i>
            <h3 data-lang="delete_goal_title">×œ××—×•×§ ××ª ×”×™×¢×“?</h3>
            <p style="margin-bottom:20px; color:#666;" data-lang="delete_goal_msg">×¤×¢×•×œ×” ×–×• ×œ× × ×™×ª× ×ª ×œ×‘×™×˜×•×œ.</p>
            <input type="hidden" id="delete-goal-index">
            <div style="display:flex; gap:10px; justify-content:center;">
                <button class="btn-primary" style="background:#ccc; color:#333; width:auto; padding:10px 20px;" onclick="document.getElementById('delete-confirm-modal').classList.remove('open')" data-lang="cancel">×‘×™×˜×•×œ</button>
                <button class="btn-primary" style="background:var(--danger); width:auto; padding:10px 20px;" onclick="confirmDeleteGoal()" data-lang="yes_delete">××—×§</button>
            </div>
        </div>
    </div>
    
    <div id="delete-shift-modal" class="modal-overlay">
        <div class="modal-card" style="text-align:center;">
            <i class="fas fa-trash-alt" style="font-size:3rem; color:var(--danger); margin-bottom:10px;"></i>
            <h3 data-lang="delete_shift_title">×œ××—×•×§ ×¡×•×’ ××©××¨×ª?</h3>
            <p style="margin-bottom:20px; color:#666;" data-lang="delete_shift_msg">×”× ×ª×•× ×™× ×©×œ ××©××¨×ª ×–×• ×™×™××—×§×•.</p>
            <input type="hidden" id="delete-shift-id">
            <div style="display:flex; gap:10px; justify-content:center;">
                <button class="btn-primary" style="background:#ccc; color:#333; width:auto; padding:10px 20px;" onclick="document.getElementById('delete-shift-modal').classList.remove('open')" data-lang="cancel">×‘×™×˜×•×œ</button>
                <button class="btn-primary" style="background:var(--danger); width:auto; padding:10px 20px;" onclick="performDeleteShift()" data-lang="yes_delete">××—×§</button>
            </div>
        </div>
    </div>

    <div id="reset-confirm-modal" class="modal-overlay">
        <div class="modal-card" style="text-align:center;">
            <i class="fas fa-trash-restore" style="font-size:3rem; color:#ff9800; margin-bottom:15px;"></i>
            <h3 data-lang="reset_month_title">×œ××¤×¡ ××ª ×”×—×•×“×©?</h3>
            <p style="color:#666; margin-bottom:20px;" data-lang="reset_month_msg">×›×œ ×”××©××¨×•×ª ×™×™××—×§×•.</p>
            <div style="display:flex; gap:10px; justify-content:center;">
                <button class="ssc-btn ghost" onclick="document.getElementById('reset-confirm-modal').classList.remove('open')" data-lang="cancel">×‘×™×˜×•×œ</button>
                <button class="ssc-btn danger" onclick="performRealReset()" data-lang="yes_reset">×›×Ÿ, ××¤×¡</button>
            </div>
        </div>
    </div>

    <div id="custom-alert-modal" class="modal-overlay">
        <div class="modal-card" style="text-align:center; padding:30px;">
            <div id="alert-icon" style="font-size:3rem; margin-bottom:15px;">âœ…</div>
            <h3 id="alert-title" style="margin-bottom:10px;" data-lang="alert_title">×”×•×“×¢×”</h3>
            <p id="alert-message" style="margin-bottom:25px; color:#666; font-size:1.1rem;">...</p>
            <button class="btn-primary" onclick="closeCustomAlert()" data-lang="confirm">××™×©×•×¨</button>
        </div>
    </div>

    <div id="general-confirm-modal" class="modal-overlay">
        <div class="modal-card" style="text-align:center;">
            <i class="fas fa-question-circle" style="font-size:3rem; color:var(--primary); margin-bottom:10px;"></i>
            <h3 id="gen-confirm-title" style="margin-bottom:10px;">?</h3>
            <p id="gen-confirm-msg" style="margin-bottom:20px; color:#666;">?</p>
            
            <div style="display:flex; gap:10px; justify-content:center;">
                <button class="btn-primary" style="background:#ccc; color:#333; width:auto; padding:10px 25px;" onclick="closeGeneralConfirm()">×‘×™×˜×•×œ</button>
                <button class="btn-primary" style="background:var(--primary); width:auto; padding:10px 25px;" onclick="performGeneralConfirm()">××™×©×•×¨</button>
            </div>
        </div>
    </div>

    <div id="cat-modal" class="modal-overlay">
        <div class="modal-card">
            <h3 data-lang="new_cat_title">×§×˜×’×•×¨×™×” ×—×“×©×”</h3>
            <input type="text" id="new-cat-name" class="qa-input" style="width:100%; margin-bottom:15px" data-lang-placeholder="cat_name_ph" placeholder="×©×">
            <div style="margin-bottom:15px; text-align:right">
                <label style="font-size:0.8rem; color:#666" data-lang="icon_label">×¡××œ:</label>
                <div class="emoji-grid"><span class="emoji-opt" onclick="selectEmoji('ğŸ•')">ğŸ•</span><span class="emoji-opt" onclick="selectEmoji('ğŸš—')">ğŸš—</span><span class="emoji-opt" onclick="selectEmoji('ğŸ ')">ğŸ </span><span class="emoji-opt" onclick="selectEmoji('ğŸ‘•')">ğŸ‘•</span></div>
                <input type="text" id="new-cat-emoji" class="qa-input" style="width:100%" data-lang-placeholder="icon_ph" placeholder="××• ×”×§×œ×“..." value="ğŸ“">
            </div>
            <input type="number" id="new-cat-limit" class="qa-input" style="width:100%; margin-bottom:15px" data-lang-placeholder="cat_limit_ph" placeholder="×ª×§×¦×™×‘">
            <div style="display:flex; gap:10px;"><button class="btn-primary" style="background:#ccc; color:#333" onclick="closeCategoryModal()" data-lang="cancel">×‘×™×˜×•×œ</button><button class="btn-primary" onclick="confirmAddCategory()" data-lang="add">×”×•×¡×£</button></div>
        </div>
    </div>

    <div id="limit-modal" class="modal-overlay">
        <div class="modal-card">
            <h3 data-lang="edit_budget_title">×¢×“×›×•×Ÿ ×ª×§×¦×™×‘</h3>
            <p id="limit-modal-cat-name" style="margin-bottom:10px"></p>
            <input type="number" id="edit-cat-limit" class="qa-input" style="width:100%; margin-bottom:15px">
            <input type="hidden" id="edit-cat-id">
            <div style="display:flex; gap:10px;"><button class="btn-primary" style="background:#ccc; color:#333" onclick="document.getElementById('limit-modal').classList.remove('open')" data-lang="cancel">×‘×™×˜×•×œ</button><button class="btn-primary" onclick="confirmEditLimit()" data-lang="update">×¢×“×›×Ÿ</button></div>
        </div>
    </div>

    <div id="buy-item-modal" class="modal-overlay">
        <div class="modal-card">
            <h3>×‘×—×¨ ×§×˜×’×•×¨×™×” ×œ×—×™×•×‘</h3>
            <input type="hidden" id="buy-item-index">
            <select id="buy-cat-select" class="qa-input" style="width:100%; margin-bottom:15px;"></select>
            <div style="display:flex; gap:10px;"><button class="btn-primary" style="background:#ccc; color:#333" onclick="document.getElementById('buy-item-modal').classList.remove('open')" data-lang="cancel">×‘×™×˜×•×œ</button><button class="btn-primary" onclick="confirmBuyItem()" data-lang="confirm">×‘×¦×¢ ×¨×›×™×©×”</button></div>
        </div>
    </div>

    <script>
        /* =========================================
           1. GLOBAL VARIABLES & CONFIG
           ========================================= */
        let currentCurrency = localStorage.getItem('appCurrency') || 'ILS';
        let currentLang = localStorage.getItem('appLang') || 'he';
        let pinCode = localStorage.getItem('appPin') || null;
        let currentDate = new Date();
        let isDarkMode = localStorage.getItem('darkMode') === 'true';
        let chartInstance = null;
        let chartType = 'bar';
        let postAlertAction = null;
        let categorySortable = null;
        let pendingAction = null;
        let ratesData = {};

        // --- DATA INITIALIZATION ---
        let appData = {
            categories: [
                { id: 1, name: '××–×•×Ÿ', emoji: 'ğŸ•', limit: 2000, items: [] }, 
                { id: 2, name: '×¨×›×‘', emoji: 'ğŸš—', limit: 800, items: [] }, 
                { id: 3, name: '×—×©×‘×•× ×•×ª', emoji: 'ğŸ ', limit: 1500, items: [] }
            ],
            goals: [], 
            bank: 0, 
            monthlySalaries: {}, 
            recurringSettings: [], 
            wishlist: [], 
            lastProcessedMonth: "", 
            lastLogin: Date.now(), 
            isPremium: false,
            settings: { theme: 'default', haptics: true, billingDay: 1 }
        };

        // Load from Storage safely
        try {
            const stored = JSON.parse(localStorage.getItem('budgetUltimateDataV23'));
            if (stored) {
                appData = { ...appData, ...stored };
                // Ensure arrays exist
                if (!appData.recurringSettings) appData.recurringSettings = [];
                if (!appData.wishlist) appData.wishlist = [];
                if (!appData.settings) appData.settings = { theme: 'default', haptics: true, billingDay: 1 };
                
                // Fix recurring types for old data
                appData.recurringSettings.forEach(rec => {
                    if(!rec.type) { rec.type = 'fixed'; rec.remaining = 0; rec.totalPayments = 0; }
                });
            }
        } catch (e) { console.error("Data Load Error", e); }

        /* =========================================
           2. DICTIONARIES (TRANSLATIONS)
           ========================================= */
        const translations = {
            he: {
                dir: 'rtl', locale: 'he-IL', remove_pin: "×”×¡×¨ ×§×•×“ × ×¢×™×œ×”",
                app_title: "Neto", subtitle: "× ×™×”×•×œ ×ª×§×¦×™×‘ ×—×›× ×•×¤×©×•×˜", daily_tip: "×˜×™×¤ ×™×•××™", start_btn: "×‘×•××• × ×ª×—×™×œ",
                menu_title: "×ª×¤×¨×™×˜", menu_home: "×¨××©×™", menu_converter: "×××™×¨ ××˜×‘×¢×•×ª", menu_recur: "×”×•×¦××•×ª ×§×‘×•×¢×•×ª", menu_calc: "××—×©×‘×•×Ÿ ×©×›×¨", menu_loan: "××—×©×‘×•×Ÿ ×”×œ×•×•××”", menu_split: "×¤×™×¦×•×œ ×—×©×‘×•×Ÿ", menu_wishlist: "×¨×©×™××ª ××©××œ×•×ª", menu_pro: "×¤×¨×™××™×•×", menu_backup: "×”×’×“×¨×•×ª", menu_dark: "××¦×‘ ×œ×™×œ×”", setup_pin: "×”×’×“×¨×ª ×§×•×“ × ×¢×™×œ×”",
                balance_label: "×¢×•\"×© ×‘×‘× ×§", salary_label: "××©×›×•×¨×ª", filter_all: "×›×œ ×”×§×˜×’×•×¨×™×•×ª", search_ph: "×—×™×¤×•×© ×”×•×¦××•×ª...", left_to_spend: "× ×•×ª×¨ ×œ×‘×–×‘×•×–:",
                savings_title: "×§×•×¤×•×ª ×—×™×¡×›×•×Ÿ", new_goal_btn: "+ ×™×¢×“ ×—×“×©", chart_toggle: "×”×—×œ×£ ×ª×¦×•×’×”",
                budget: "×ª×§×¦×™×‘:", add: "×”×•×¡×£", desc_placeholder: "×ª×™××•×¨", amount_placeholder: "×¡×›×•×",
                recur_title: "×”×•×¦××•×ª ×§×‘×•×¢×•×ª", add_new: "+ ×”×•×¡×¤×” ×—×“×©×”", recur_name_ph: "×©× (×œ××©×œ: × ×˜×¤×œ×™×§×¡)", save_order: "×©××•×¨ ×”×•×¨××”",
                active_orders: "×¨×©×™××ª ×”×•×¨××•×ª ×¤×¢×™×œ×•×ª", col_name: "×©×", col_cat: "×§×˜×’×•×¨×™×”", col_amount: "×¡×›×•×", col_del: "××—×§", no_recur: "××™×Ÿ ×”×•×¨××•×ª ×§×‘×¢ ××•×’×“×¨×•×ª",
                calc_title: "×—×™×©×•×‘ ×©×›×¨", mode_free: "××¦×‘ ×¢×¨×™×›×” ×—×•×¤×©×™", reset: "××™×¤×•×¡", hourly_wage: "×©×›×¨ ×œ×©×¢×”", month: "×—×•×“×©",
                add_shift_title: "×”×•×¡×¤×ª ×¡×•×’ ××©××¨×ª", shift_name_ph: "×©×", add_step: "+ ×”×•×¡×£ ××“×¨×’×”", save_type: "×©××•×¨ ×¡×•×’",
                no_shifts: "××™×Ÿ ××©××¨×•×ª ××•×’×“×¨×•×ª", stat_shifts: "××©××¨×•×ª", stat_hours: "×©×¢×•×ª", stat_wage: "×©×›×¨",
                free_calc_title: "××—×©×‘×•×Ÿ ×—×•×¤×©×™ (×ª×•×¡×¤×•×ª)", col_desc: "×ª×™××•×¨", col_hours: "×©×¢×•×ª", col_percent: "××—×•×– %", add_row: "+ ×”×•×¡×£ ×©×•×¨×”", total_additions: "×¡×”×´×› ×ª×•×¡×¤×•×ª:",
                full_details: "×¤×™×¨×•×˜ ××œ×", col_type: "×¡×•×’", col_qty: "×›××•×ª", col_total: "×¡×”×´×›", grand_total: "×¡×”×´×› ×›×•×œ×œ",
                settings_title: "×”×’×“×¨×•×ª ×•×’×™×‘×•×™", backup_btn: "×’×™×‘×•×™ ××œ× (×©×ª×£)", restore_btn: "×©×—×–×•×¨ ××’×™×‘×•×™", export_btn: "×™×™×¦×•× ×œ××§×¡×œ (×©×ª×£)", close: "×¡×’×•×¨",
                delete_cat_title: "×œ××—×•×§ ××ª ×”×§×˜×’×•×¨×™×”?", delete_cat_msg: "×”×§×˜×’×•×¨×™×” ×•×›×œ ×”×”×•×¦××•×ª ×™×™××—×§×•.\n×œ× × ×™×ª×Ÿ ×œ×©×—×–×¨!", cancel: "×‘×™×˜×•×œ", yes_delete: "×›×Ÿ, ××—×§",
                new_goal_title: "×™×¢×“ ×—×™×¡×›×•×Ÿ ×—×“×©", goal_name_ph: "×©× ×”×™×¢×“", goal_target_ph: "×¡×›×•× ×™×¢×“", choose_color: "×‘×—×¨ ×¦×‘×¢:", save: "×©××•×¨",
                deposit_title: "×”×¤×§×“×” ×œ×™×¢×“", deposit_amount_ph: "×¡×›×•× ×œ×”×¤×§×“×”", deposit_btn: "×”×¤×§×“",
                delete_goal_title: "×œ××—×•×§ ××ª ×”×™×¢×“?", delete_goal_msg: "×¤×¢×•×œ×” ×–×• ×œ× × ×™×ª× ×ª ×œ×‘×™×˜×•×œ.",
                delete_shift_title: "×œ××—×•×§ ×¡×•×’ ××©××¨×ª?", delete_shift_msg: "×”× ×ª×•× ×™× ×©×œ ××©××¨×ª ×–×• ×™×™××—×§×•.",
                reset_month_title: "×œ××¤×¡ ××ª ×”×—×•×“×©?", reset_month_msg: "×›×œ ×”××©××¨×•×ª ×™×™××—×§×•.", yes_reset: "×›×Ÿ, ××¤×¡",
                alert_title: "×”×•×“×¢×”", confirm: "××™×©×•×¨",
                new_cat_title: "×§×˜×’×•×¨×™×” ×—×“×©×”", cat_name_ph: "×©×", icon_label: "×¡××œ:", icon_ph: "××• ×”×§×œ×“...", cat_limit_ph: "×ª×§×¦×™×‘",
                edit_budget_title: "×¢×“×›×•×Ÿ ×ª×§×¦×™×‘", update: "×¢×“×›×Ÿ",
                premium_title: "Premium", premium_title_header: "Premium", upgrade_pro: "×©×“×¨×•×’ ×œ×¤×¨×•", pro_desc: "×”×¡×¨×ª ×¤×¨×¡×•××•×ª, ×’×™×‘×•×™ ×‘×¢× ×Ÿ ×•×ª××™×›×”.", coming_soon: "×‘×§×¨×•×‘",
                footer_rights: "Â© All rights reserved for Neto App , Developer: Cohen's.",
                tips: ["×”×“×¨×š ×œ×¢×•×©×¨ ××ª×—×™×œ×” ×‘×©×§×œ ×”×¨××©×•×Ÿ ×©×—×•×¡×›×™×.", "×œ× ××©× ×” ×›××” ××ª×” ××¨×•×•×™×—, ××©× ×” ×›××” ××ª×” ×©×•××¨.", "×ª×§×¦×™×‘ ×”×•× ×œ× ×›×œ×, ×”×•× ×”××¤×ª×— ×œ×—×•×¤×©.", "×›×¡×£ ×”×•× ××©×¨×ª × ×”×“×¨ ××‘×œ ××“×•×Ÿ × ×•×¨×.", "×”×©×§×¢×” ×‘×¢×¦××š ×× ×™×‘×” ××ª ×”×¨×™×‘×™×ª ×”×’×‘×•×”×” ×‘×™×•×ª×¨.", "×”×•×¦××•×ª ×§×˜× ×•×ª ××¦×˜×‘×¨×•×ª ×œ×”×•×Ÿ ×’×“×•×œ.", "×©×œ×™×˜×” ×‘×›×¡×£ ×”×™× ×©×œ×™×˜×” ×‘×—×™×™×.", "×”×¢×•×©×¨ ×”×××™×ª×™ ×”×•× ×”×©×§×˜ ×”× ×¤×©×™.", "××œ ×ª×§× ×” ××” ×©××ª×” ×œ× ×¦×¨×™×š.", "×ª×§×¦×™×‘ ×—×›× ×”×™×•× = ×—×•×¤×© ×›×œ×›×œ×™ ××—×¨."],
                pin_enter: "×”×–×Ÿ ×§×•×“ ×’×™×©×”", pin_setup: "×‘×—×¨ ×§×•×“ ×’×™×©×” ×—×“×©", pin_confirm: "×××ª ×§×•×“ ×’×™×©×”", pin_wrong: "×§×•×“ ×©×’×•×™", pin_match_err: "×§×•×“ ×œ× ×ª×•××",
                converter_title: "×××™×¨ ××˜×‘×¢×•×ª", convert_btn: "×”××¨ ×›×¢×ª",
                loan_amount: "×¡×›×•× ×”×”×œ×•×•××”", loan_interest: "×¨×™×‘×™×ª ×©× ×ª×™×ª (%)", loan_years: "×ª×§×•×¤×” (×©× ×™×)", calculate: "×—×©×‘", monthly_payment: "×”×—×–×¨ ×—×•×“×©×™",
                bill_amount: "×¡×›×•× ×”×—×©×‘×•×Ÿ", tip_percent: "×˜×™×¤ (%)", num_people: "××¡×¤×¨ ×× ×©×™×", total_per_person: "×¡×”×´×› ×œ××“×",
                item_name: "×©× ××•×¦×¨", item_price: "××—×™×¨", no_items: "××™×Ÿ ×¤×¨×™×˜×™× ×‘×¨×©×™××”",
                wishlist_tip: "×œ×¤× ×™ ×©×§×•× ×™× - ×—×•×©×‘×™× ×¤×¢××™×™×! ğŸ’­",
                type_fixed: "×”×•×¨××ª ×§×‘×¢", type_installments: "×ª×©×œ×•××™×", num_payments: "××¡×¤×¨ ×ª×©×œ×•××™×"
            },
            en: {
                dir: 'ltr', locale: 'en-US', remove_pin: "Remove PIN Lock",
                app_title: "Neto", subtitle: "Smart Budget Management", daily_tip: "Daily Tip", start_btn: "Let's Start",
                menu_title: "Menu", menu_home: "Dashboard", menu_converter: "Currency Converter", menu_recur: "Recurring Expenses", menu_calc: "Salary Calc", menu_loan: "Loan Calc", menu_split: "Split Bill", menu_wishlist: "Wishlist", menu_pro: "Premium", menu_backup: "Settings", menu_dark: "Dark Mode", setup_pin: "Setup PIN Lock",
                balance_label: "Bank Balance", salary_label: "Salary", filter_all: "All Categories", search_ph: "Search expenses...", left_to_spend: "Left to Spend:",
                savings_title: "Savings Goals", new_goal_btn: "+ New Goal", chart_toggle: "Toggle View",
                budget: "Budget:", add: "Add", desc_placeholder: "Description", amount_placeholder: "Amount",
                recur_title: "Recurring Expenses", add_new: "+ Add New", recur_name_ph: "Name (e.g. Netflix)", save_order: "Save Order",
                active_orders: "Active Orders", col_name: "Name", col_cat: "Category", col_amount: "Amount", col_del: "Del", no_recur: "No active orders defined",
                calc_title: "Salary Calc", mode_free: "Free Edit Mode", reset: "Reset", hourly_wage: "Hourly Wage", month: "Month",
                add_shift_title: "Add Shift Type", shift_name_ph: "Name", add_step: "+ Add Step", save_type: "Save Type",
                no_shifts: "No shifts defined", stat_shifts: "Shifts", stat_hours: "Hours", stat_wage: "Salary",
                free_calc_title: "Free Calculator (Additions)", col_desc: "Desc", col_hours: "Hours", col_percent: "Percent %", add_row: "+ Add Row", total_additions: "Total Additions:",
                full_details: "Full Details", col_type: "Type", col_qty: "Qty", col_total: "Total", grand_total: "Grand Total",
                settings_title: "Settings", backup_btn: "Full Backup (Share)", restore_btn: "Restore from Backup", export_btn: "Export to CSV (Share)", close: "Close",
                delete_cat_title: "Delete Category?", delete_cat_msg: "Category and all expenses will be deleted.\nCannot be undone!", cancel: "Cancel", yes_delete: "Yes, Delete",
                new_goal_title: "New Savings Goal", goal_name_ph: "Goal Name", goal_target_ph: "Target Amount", choose_color: "Choose Color:", save: "Save",
                deposit_title: "Deposit to Goal", deposit_amount_ph: "Deposit Amount", deposit_btn: "Deposit",
                delete_goal_title: "Delete Goal?", delete_goal_msg: "This action cannot be undone.",
                delete_shift_title: "Delete Shift Type?", delete_shift_msg: "Data for this shift type will be deleted.",
                reset_month_title: "Reset Month?", reset_month_msg: "All shifts will be deleted.", yes_reset: "Yes, Reset",
                alert_title: "Message", confirm: "OK",
                new_cat_title: "New Category", cat_name_ph: "Name", icon_label: "Icon:", icon_ph: "Or type...", cat_limit_ph: "Budget",
                edit_budget_title: "Update Budget", update: "Update",
                premium_title: "Premium", premium_title_header: "Premium", upgrade_pro: "Upgrade to Pro", pro_desc: "Remove ads, cloud backup & support.", coming_soon: "Coming Soon",
                footer_rights: "Â© All rights reserved for Neto App , Developer: Cohen's.",
                tips: ["The road to wealth starts with the first coin saved.", "It's not how much you make, it's how much you keep.", "A budget is telling your money where to go instead of wondering where it went.", "Money is a terrible master but an excellent servant.", "Investing in yourself pays the best interest.", "Small expenses add up to a big fortune.", "Mastering money is mastering life.", "True wealth is peace of mind.", "Don't buy what you don't need.", "Smart budgeting today = Financial freedom tomorrow."],
                pin_enter: "Enter PIN", pin_setup: "Choose New PIN", pin_confirm: "Confirm PIN", pin_wrong: "Wrong PIN", pin_match_err: "PINs do not match",
                converter_title: "Currency Converter", convert_btn: "Convert",
                loan_amount: "Loan Amount", loan_interest: "Annual Interest (%)", loan_years: "Term (Years)", calculate: "Calculate", monthly_payment: "Monthly Payment",
                bill_amount: "Bill Amount", tip_percent: "Tip (%)", num_people: "Number of People", total_per_person: "Total Per Person",
                item_name: "Item Name", item_price: "Price", no_items: "No items in wishlist",
                wishlist_tip: "Think twice before buying! ğŸ’­",
                type_fixed: "Fixed Recurring", type_installments: "Installments", num_payments: "Number of Payments"
            }
        };

        const currencyNames = {
            USD: { he: "×“×•×œ×¨ ×××¨×™×§××™", en: "US Dollar" }, EUR: { he: "××™×¨×•", en: "Euro" }, ILS: { he: "×©×§×œ ×—×“×©", en: "Israeli Shekel" }, GBP: { he: "×œ×™×¨×” ×©×˜×¨×œ×™× ×’", en: "British Pound" }, JPY: { he: "×™×™×Ÿ ×™×¤× ×™", en: "Japanese Yen" }, AUD: { he: "×“×•×œ×¨ ××•×¡×˜×¨×œ×™", en: "Australian Dollar" }, CAD: { he: "×“×•×œ×¨ ×§× ×“×™", en: "Canadian Dollar" }, CHF: { he: "×¤×¨× ×§ ×©×•×•×™×¦×¨×™", en: "Swiss Franc" }, CNY: { he: "×™×•××Ÿ ×¡×™× ×™", en: "Chinese Yuan" }, RUB: { he: "×¨×•×‘×œ ×¨×•×¡×™", en: "Russian Ruble" }, BRL: { he: "×¨×™××œ ×‘×¨×–×™×œ××™", en: "Brazilian Real" }, INR: { he: "×¨×•×¤×™ ×”×•×“×™", en: "Indian Rupee" }, TRY: { he: "×œ×™×¨×” ×˜×•×¨×§×™×ª", en: "Turkish Lira" }, ZAR: { he: "×¨×× ×“ ×“×¨×•× ××¤×¨×™×§××™", en: "South African Rand" }, EGP: { he: "×œ×™×¨×” ××¦×¨×™×ª", en: "Egyptian Pound" }, JOD: { he: "×“×™× ×¨ ×™×¨×“× ×™", en: "Jordanian Dinar" }
        };

        // === 3. CORE FUNCTIONS (Safe) ===
        function t(key) { 
            if (!translations[currentLang]) currentLang = 'he';
            return translations[currentLang][key] || key; 
        }

        function formatMoney(n) {
            let loc = 'he-IL';
            if(translations[currentLang]) loc = translations[currentLang].locale;
            return n.toLocaleString(loc, { style: 'currency', currency: currentCurrency, maximumFractionDigits: 0 }); 
        }
function checkPinLock() {
            // ×˜×¢×™× ×ª ×”×§×•×“ ××”×–×™×›×¨×•×Ÿ
            pinCode = localStorage.getItem('appPin');
            
            // ×‘×“×™×§×” ×”×× ×™×© ×§×•×“ ××•×’×“×¨
            if (pinCode) {
                // ×”×¦×’×ª ××¡×š ×”× ×¢×™×œ×”
                const lockScreen = document.getElementById('pin-lock-screen');
                if (lockScreen) lockScreen.classList.add('active');
                
                // ×¢×“×›×•×Ÿ ×”×›×•×ª×¨×ª ×œ"×”×–×Ÿ ×§×•×“"
                const title = document.getElementById('pin-title');
                if (title) title.innerText = t('pin_enter');
                
                // ×”×¡×ª×¨×ª ×›×¤×ª×•×¨ ×”×‘×™×˜×•×œ (×›×™ ×‘×›× ×™×¡×” ×—×™×™×‘×™× ×œ×”×§×™×© ×§×•×“)
                const cancelBtn = document.getElementById('pin-cancel-btn');
                if (cancelBtn) cancelBtn.style.display = 'none';
                
                // ××™×¤×•×¡ ×”×§×œ×˜
                pinInput = "";
                if (typeof updatePinDots === 'function') updatePinDots();
                
                return true; // ××—×–×™×¨ '×××ª' - ×”××¤×œ×™×§×¦×™×” × ×¢×•×œ×”
            }
            return false; // ××—×–×™×¨ '×©×§×¨' - ×”××¤×œ×™×§×¦×™×” ×¤×ª×•×—×”
        }
        function triggerHaptic() { if(appData.settings.haptics && navigator.vibrate) navigator.vibrate(10); }
        
        function saveData() { localStorage.setItem('budgetUltimateDataV23', JSON.stringify(appData)); }

        // --- Settings Logic ---
        function applyTheme(themeName) {
            document.body.classList.remove('theme-ocean', 'theme-forest', 'theme-sunset', 'theme-luxury');
            if(themeName !== 'default') document.body.classList.add('theme-' + themeName);
            appData.settings.theme = themeName;
            saveData();
        }
        
        function toggleHaptic() {
            appData.settings.haptics = document.getElementById('haptic-toggle').checked;
            saveData();
            if(appData.settings.haptics) triggerHaptic();
        }

        function updateBillingDayVal() {
            const val = document.getElementById('billing-day-slider').value;
            document.getElementById('bill-day-val').innerText = val;
        }

        function saveBillingDay() {
            const val = document.getElementById('billing-day-slider').value;
            appData.settings.billingDay = parseInt(val);
            saveData();
            renderApp();
        }

        // --- Main Render Logic (With Date Cycle) ---
        function renderApp() {
            const startDay = parseInt(appData.settings.billingDay) || 1;
            const key = getMonthKey(currentDate); // Using current visual month
            
            document.getElementById('salary-input').value = (appData.monthlySalaries && appData.monthlySalaries[key]) ? appData.monthlySalaries[key] : '';
            
            const filterCat = document.getElementById('cat-filter'); const currentFilter = filterCat.value;
            filterCat.innerHTML = `<option value="all">${t('filter_all')}</option>` + appData.categories.map(c => `<option value="${c.id}">${c.emoji} ${c.name}</option>`).join('');
            filterCat.value = currentFilter;

            const container = document.getElementById('categories-container'); container.innerHTML = '';
            let totalExpenses = 0;
            const searchTerm = document.getElementById('search-bar').value.toLowerCase();

            appData.categories.forEach(cat => {
                if(currentFilter !== 'all' && cat.id != currentFilter) return;
                
                // Advanced Cycle Filtering
                let filteredItems = cat.items.filter(item => {
                    const d = new Date(item.date);
                    // Determine cycle month of item
                    let cycleMonth = d.getMonth();
                    let cycleYear = d.getFullYear();
                    
                    if (startDay > 1 && d.getDate() >= startDay) {
                        cycleMonth++;
                        if (cycleMonth > 11) { cycleMonth = 0; cycleYear++; }
                    }
                    
                    return cycleMonth === currentDate.getMonth() && cycleYear === currentDate.getFullYear();
                });

                if(searchTerm) {
                    filteredItems = filteredItems.filter(item => item.text.toLowerCase().includes(searchTerm));
                }

                const catTotal = filteredItems.reduce((sum, item) => sum + item.amount, 0); 
                if(!searchTerm) totalExpenses += catTotal;

                if(searchTerm && filteredItems.length === 0) return;

                const spentPos = Math.abs(Math.min(0, catTotal)); const limit = cat.limit || 1000; const percent = Math.min(100, (spentPos / limit) * 100);
                let colorClass = percent > 100 ? 'bg-red' : (percent > 75 ? 'bg-yellow' : 'bg-green'); let balanceStyle = percent >= 100 ? 'color:var(--danger)' : '';

                const card = document.createElement('div'); card.className = 'category-card animate-item'; card.setAttribute('data-id', cat.id); 
                const deleteBtnHtml = `<div class="cat-delete-main-btn" onclick="deleteCategoryMain(${cat.id})"><i class="fas fa-times"></i></div>`;
                const dragHandleHtml = `<div class="drag-handle"><i class="fas fa-sort"></i></div>`;

                card.innerHTML = `
                    ${deleteBtnHtml} ${dragHandleHtml}
                    <div class="card-header">
                        <div class="cat-info"><div class="cat-emoji">${cat.emoji}</div><div><div style="font-weight:bold">${cat.name}</div><div class="cat-limit" onclick="openLimitModal(${cat.id})">${t('budget')} ${limit} <i class="fas fa-pen" style="font-size:0.7rem"></i></div></div></div>
                        <div class="current-spend" style="${balanceStyle}">${formatMoney(catTotal)}</div>
                    </div>
                    <div class="progress-track"><div class="progress-fill ${colorClass}" style="width:${percent}%"></div></div>
                    <ul class="items-list">
                        ${filteredItems.map(item => {
                            let icon = item.method === 'cash' ? '<i class="fas fa-money-bill-wave pay-method-icon"></i>' : (item.method === 'transfer' ? '<i class="fas fa-university pay-method-icon"></i>' : '<i class="fas fa-credit-card pay-method-icon"></i>');
                            let dObj = new Date(item.date);
                            let dateStr = dObj.getDate() + '/' + (dObj.getMonth()+1);
                            
                            return `<li class="item-row">
                                <span style="display:flex;flex-direction:column;">
                                    <span>${item.text} ${item.isAuto ? '<i class="fas fa-robot"></i>' : ''}</span>
                                    <span style="font-size:0.7rem; opacity:0.6;">${dateStr}</span>
                                </span>
                                <div>${icon}
                                    <span class="${item.amount < 0 ? 'amount-neg' : 'amount-pos'}">${formatMoney(Math.abs(item.amount))}</span>
                                    <i class="fas fa-copy" onclick="duplicateItem(${cat.id}, '${item.id}')" style="margin:0 5px; color:#aaa; cursor:pointer;"></i>
                                    <i class="fas fa-times" onclick="deleteItem(${cat.id}, '${item.id}')" style="margin-right:5px; color:#ccc; cursor:pointer;"></i>
                                </div>
                            </li>`
                        }).join('')}
                    </ul>
                    <div class="quick-add">
                        <div class="qa-row"><input id="d-${cat.id}" class="qa-input" placeholder="${t('desc_placeholder')}"></div>
                        <div class="qa-row"><input id="a-${cat.id}" type="number" class="qa-input" placeholder="${t('amount_placeholder')}"><select id="m-${cat.id}" class="qa-input" style="flex:0.5"><option value="credit">ğŸ’³</option><option value="cash">ğŸ’µ</option><option value="transfer">ğŸ¦</option></select></div>
                        <button class="qa-btn" onclick="addItem(${cat.id})"><i class="fas fa-plus"></i> ${t('add')}</button>
                    </div>`;
                container.appendChild(card);
            });

            if(categorySortable) categorySortable.destroy();
            categorySortable = new Sortable(container, { animation: 150, handle: '.drag-handle', onEnd: function (evt) { const item = appData.categories.splice(evt.oldIndex, 1)[0]; appData.categories.splice(evt.newIndex, 0, item); saveData(); } });

            if(!searchTerm) {
                const bank = parseFloat(appData.bank) || 0; 
                const salary = parseFloat(appData.monthlySalaries?.[key]) || 0; 
                const total = bank + salary + totalExpenses;
                
                const totalSaved = appData.goals.reduce((acc, g) => acc + g.current, 0);
                const leftToSpend = total - totalSaved;

                document.getElementById('global-balance').innerText = formatMoney(total); 
                document.getElementById('global-balance').style.color = total < 0 ? 'var(--danger)' : 'white';
                
                document.getElementById('left-to-spend').innerText = t('left_to_spend') + ' ' + formatMoney(leftToSpend);

                renderHistoryChart();
            }
            renderSavings();
        }

        // === 4. STARTUP ===
        document.addEventListener('DOMContentLoaded', () => {
            if(isDarkMode) document.body.classList.add('dark-mode');
            
            // Critical First Steps
            checkPinLock();
            
            // Init UI settings
            const haptToggle = document.getElementById('haptic-toggle');
            if(haptToggle) haptToggle.checked = appData.settings.haptics;
            applyTheme(appData.settings.theme || 'default');
            
            const billSlider = document.getElementById('billing-day-slider');
            const savedBillDay = appData.settings.billingDay || 1;
            billSlider.value = savedBillDay;
            document.getElementById('bill-day-val').innerText = savedBillDay;

            // Load Content
            setLanguage(currentLang);
            setCurrency(currentCurrency);
            document.getElementById('bank-input').value = appData.bank || '';

            checkAndRunRecurring();
            updateMonthDisplay();
            renderApp();
            checkPremiumStatus();
            
            // Load Heavy Modules
            if(typeof initSalaryCalculator === 'function') initSalaryCalculator();
            if(typeof initConverter === 'function') initConverter();
            if(typeof renderWishlist === 'function') renderWishlist();
            
            appData.lastLogin = Date.now();
            saveData();
        });

        // === REST OF FUNCTIONS ===
function setLanguage(lang) {
            triggerHaptic();
            currentLang = lang;
            localStorage.setItem('appLang', lang);
            const dir = translations[lang].dir;
            document.documentElement.setAttribute('dir', dir);
            document.querySelectorAll('[data-lang]').forEach(el => { const key = el.getAttribute('data-lang'); if(translations[lang][key]) el.innerText = translations[lang][key]; });
            document.querySelectorAll('[data-lang-placeholder]').forEach(el => { const key = el.getAttribute('data-lang-placeholder'); if(translations[lang][key]) el.placeholder = translations[lang][key]; });
            const arrow = document.getElementById('start-arrow');
            if(arrow) arrow.className = dir === 'rtl' ? 'fas fa-arrow-left' : 'fas fa-arrow-right';
            document.querySelectorAll('[data-lang-btn]').forEach(btn => { btn.classList.remove('active'); if(btn.dataset.langBtn === lang) btn.classList.add('active'); });
            updateTip();
            refreshAll();
        }
function updateTip() {
            const tips = translations[currentLang].tips;
            const randTip = tips[Math.floor(Math.random() * tips.length)];
            const tipEl = document.getElementById('landing-tip-text');
            const motEl = document.getElementById('motivation-text');
            if(tipEl) tipEl.innerText = randTip;
            if(motEl) motEl.innerText = randTip;
        }
function refreshAll() {
            if(typeof updateMonthDisplay === 'function') updateMonthDisplay();
            if(typeof renderApp === "function") renderApp();
            if(typeof renderRecurringPage === "function") renderRecurringPage();
            if(typeof renderSavings === "function") renderSavings();
            if(typeof initConverter === "function") initConverter(); 
            if(document.getElementById('ssc_grid') && typeof initSalaryCalculator === "function") initSalaryCalculator();
            if(typeof renderWishlist === "function") renderWishlist();
        }
function setCurrency(code) {
            triggerHaptic();
            currentCurrency = code;
            localStorage.setItem('appCurrency', code);
            document.querySelectorAll('[data-curr-btn]').forEach(btn => {
                btn.classList.remove('active');
                if(btn.dataset.currBtn === code) btn.classList.add('active');
            });
            refreshAll();
        }


        function toggleMenu() { document.getElementById('side-menu').classList.toggle('open'); document.getElementById('menu-overlay').classList.toggle('open'); document.body.classList.toggle('no-scroll'); }
        function navTo(pageName) { triggerHaptic(); if(document.getElementById('side-menu').classList.contains('open')) toggleMenu(); if (pageName === 'dashboard') document.getElementById('page-landing').classList.remove('active'); document.querySelectorAll('.page').forEach(el => el.classList.remove('active')); document.querySelectorAll('.menu-item').forEach(el => el.classList.remove('active')); document.getElementById(`page-${pageName}`).classList.add('active'); if(pageName === 'dashboard') renderApp(); if(pageName === 'recurring') renderRecurringPage(); if(pageName === 'wishlist') renderWishlist(); }
        function getMonthKey(date) { return `${date.getMonth()}-${date.getFullYear()}`; }
        function updateSalary() { const val = document.getElementById('salary-input').value; const key = getMonthKey(currentDate); if (!appData.monthlySalaries) appData.monthlySalaries = {}; appData.monthlySalaries[key] = val; saveAndRender(); }
        function saveAndRender() { appData.bank = document.getElementById('bank-input').value; saveData(); renderApp(); }
        function deleteCategoryMain(id) { document.getElementById('delete-cat-target-id').value = id; document.getElementById('delete-category-modal').classList.add('open'); }
        function closeDeleteCatModal() { document.getElementById('delete-category-modal').classList.remove('open'); }
        function performCategoryDelete() { const id = parseInt(document.getElementById('delete-cat-target-id').value); if(id) { appData.categories = appData.categories.filter(c => c.id !== id); saveAndRender(); closeDeleteCatModal(); showAppAlert(t('alert_title'), 'Deleted', 'ğŸ—‘ï¸'); } }
        function renderSavings() { const list = document.getElementById('savings-list'); list.innerHTML = ''; if(!appData.goals) appData.goals = []; appData.goals.forEach((goal, i) => { const percent = Math.min(100, (goal.current / goal.target) * 100); const bg = goal.color || 'linear-gradient(135deg, #a8e063, #56ab2f)'; const el = document.createElement('div'); el.className = 'saving-card animate-item'; el.style.background = bg; el.innerHTML = `<div class="saving-header"><div style="display:flex;align-items:center;gap:8px;"><span style="font-size:1.5rem;background:rgba(255,255,255,0.2);border-radius:50%;width:40px;height:40px;display:flex;align-items:center;justify-content:center;">${goal.emoji||'ğŸ’°'}</span><div><div style="font-weight:bold;font-size:1.1rem;">${goal.name}</div><div style="font-size:0.8rem;opacity:0.9;">${formatMoney(goal.current)} / ${formatMoney(goal.target)}</div></div></div></div><div class="saving-progress-bg"><div class="saving-progress-fill" style="width:${percent}%"></div></div><div style="text-align:left; margin-top:10px; display:flex; justify-content:flex-end; gap:10px;"><button style="background:rgba(255,255,255,0.2);border:none;color:white;border-radius:8px;padding:6px 12px;cursor:pointer;font-weight:bold;" onclick="openDepositModal(${i})">+ ${t('deposit_btn')}</button><button style="background:rgba(0,0,0,0.1);border:none;color:white;border-radius:8px;width:30px;cursor:pointer;" onclick="deleteGoal(${i})"><i class="fas fa-trash"></i></button></div>`; list.appendChild(el); }); }
        function openGoalModal() { document.getElementById('goal-modal').classList.add('open'); }
        function selectGoalColor(el, color) { document.querySelectorAll('.color-opt').forEach(d => d.classList.remove('selected')); el.classList.add('selected'); document.getElementById('new-goal-color').value = color; }
        function confirmAddGoal() { const name = document.getElementById('new-goal-name').value; const target = parseFloat(document.getElementById('new-goal-target').value); const emoji = document.getElementById('new-goal-emoji').value || 'ğŸ’°'; const color = document.getElementById('new-goal-color').value; if(name && target) { appData.goals.push({name, target, current:0, emoji, color}); saveAndRender(); document.getElementById('goal-modal').classList.remove('open'); document.getElementById('new-goal-name').value=''; document.getElementById('new-goal-target').value=''; } }
        function openDepositModal(index) { document.getElementById('deposit-goal-index').value = index; document.getElementById('deposit-goal-name').innerText = appData.goals[index].name; document.getElementById('deposit-amount').value = ''; document.getElementById('deposit-modal').classList.add('open'); document.getElementById('deposit-amount').focus(); }
        function confirmDeposit() { const index = parseInt(document.getElementById('deposit-goal-index').value); const amount = parseFloat(document.getElementById('deposit-amount').value); if(amount > 0) { appData.goals[index].current += amount; saveAndRender(); document.getElementById('deposit-modal').classList.remove('open'); } }
        function deleteGoal(i) { document.getElementById('delete-goal-index').value = i; document.getElementById('delete-confirm-modal').classList.add('open'); }
        function confirmDeleteGoal() { const i = parseInt(document.getElementById('delete-goal-index').value); appData.goals.splice(i, 1); saveAndRender(); document.getElementById('delete-confirm-modal').classList.remove('open'); }
        function toggleChartType() { chartType = chartType === 'bar' ? 'pie' : 'bar'; renderHistoryChart(); }
        function renderHistoryChart() { const ctx = document.getElementById('expenseChart').getContext('2d'); if(chartInstance) chartInstance.destroy(); let config = {}; if (chartType === 'bar') { let labels = [], data = []; for(let i=5; i>=0; i--) { let d = new Date(); d.setMonth(d.getMonth() - i); labels.push(d.toLocaleDateString(translations[currentLang].locale, {month:'short'})); let mTotal = 0; appData.categories.forEach(cat => { cat.items.forEach(item => { let iDate = new Date(item.date); if(iDate.getMonth() === d.getMonth() && iDate.getFullYear() === d.getFullYear()) { if(item.amount < 0) mTotal += Math.abs(item.amount); } }); }); data.push(mTotal); } config = { type: 'bar', data: { labels, datasets: [{ label: t('col_amount'), data, backgroundColor: '#4e54c8', borderRadius: 4 }] }, options: { maintainAspectRatio: false, scales: { y: { beginAtZero: true } } } }; } else { let labels = [], data = []; let colors = ['#ff7675', '#74b9ff', '#55efc4', '#a29bfe', '#ffeaa7', '#fd79a8']; appData.categories.forEach(cat => { let catSum = 0; cat.items.forEach(item => { let iDate = new Date(item.date); if(iDate.getMonth() === currentDate.getMonth() && iDate.getFullYear() === currentDate.getFullYear()) { if(item.amount < 0) catSum += Math.abs(item.amount); } }); if(catSum > 0) { labels.push(cat.name); data.push(catSum); } }); config = { type: 'pie', data: { labels, datasets: [{ data, backgroundColor: colors }] }, options: { maintainAspectRatio: false } }; } chartInstance = new Chart(ctx, config); }
        function addItem(catId) { triggerHaptic(); const desc = document.getElementById(`d-${catId}`).value; const amount = document.getElementById(`a-${catId}`).value; const method = document.getElementById(`m-${catId}`).value; if(!desc || !amount) return; const cat = appData.categories.find(c => c.id === catId); const val = parseFloat(amount); cat.items.push({ id: Date.now().toString(), text: desc, amount: -Math.abs(val), date: currentDate.toISOString(), method: method }); saveAndRender(); }
        function deleteItem(catId, itemId) { triggerHaptic(); const cat = appData.categories.find(c => c.id === catId); if(!cat) return; const item = cat.items.find(i => i.id === itemId); if(item && item.fromRecurId && appData.recurringSettings) { appData.recurringSettings = appData.recurringSettings.filter(rec => rec.id !== item.fromRecurId); saveData(); } cat.items = cat.items.filter(i => i.id !== itemId); saveAndRender(); }
        function duplicateItem(catId, itemId) { triggerHaptic(); const cat = appData.categories.find(c => c.id === catId); if(!cat) return; const item = cat.items.find(i => i.id === itemId); if(!item) return; const newItem = { ...item, id: Date.now().toString(), date: currentDate.toISOString(), isAuto: false, fromRecurId: null }; cat.items.push(newItem); saveAndRender(); showAppAlert(t('alert_title'), 'Item Duplicated', 'ğŸ“„'); }
        function openSettingsModal() { toggleMenu(); document.getElementById('settings-modal').classList.add('open'); }
        async function exportDataJSON() {
    const dataStr = JSON.stringify(appData);
    const fileName = 'budget_backup.json';

    if (typeof Android !== "undefined" && Android.saveFile) {
        Android.saveFile(dataStr, fileName, "application/json");
    } else {
        const file = new File([dataStr], fileName, { type: 'application/json' });
        if (navigator.canShare && navigator.canShare({ files: [file] })) {
            try { await navigator.share({ files: [file], title: 'Backup' }); } catch(err) {}
        } else {
            const a = document.createElement('a');
            a.href = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            a.download = fileName;
            a.click();
        }
    }
}
async function exportToCSV() {
    let csv = "\uFEFFDate,Category,Desc,Amount,Method\n";
    appData.categories.forEach(cat => {
        cat.items.forEach(i => {
            csv += `${new Date(i.date).toLocaleDateString()},${cat.name},${i.text},${i.amount},${i.method}\n`
        });
    });

    const fileName = 'budget_export.csv';

    // ×‘×“×™×§×”: ×”×× ×× ×—× ×• ×‘×ª×•×š ×”××¤×œ×™×§×¦×™×”?
    if (typeof Android !== "undefined" && Android.saveFile) {
        // ×›×Ÿ! ×©×œ×— ××ª ×”××™×“×¢ ×œ×× ×“×¨×•××™×“ ×›×“×™ ×©×™×©××•×¨
        Android.saveFile(csv, fileName, "text/csv");
    } else {
        // ×œ×, ×× ×—× ×• ×‘×“×¤×“×¤×Ÿ ×¨×’×™×œ - × ×©×ª××© ×‘×©×™×˜×” ×”×¨×’×™×œ×”
        const file = new File([csv], fileName, { type: 'text/csv' });
        if (navigator.canShare && navigator.canShare({ files: [file] })) {
            try { await navigator.share({ files: [file], title: 'Export' }); } catch(err) {}
        } else {
            const a = document.createElement('a');
            a.href = 'data:text/csv;charset=utf-8,'+ encodeURIComponent(csv);
            a.download = fileName;
            a.click();
        }
    }
}        function importDataJSON(input) { const file = input.files[0]; if(!file) return; const reader = new FileReader(); reader.onload = function(e) { try { const loadedData = JSON.parse(e.target.result); if(loadedData.categories) { appData = loadedData; saveData(); location.reload(); } } catch(err) { alert("Error"); } }; reader.readAsText(file); }
        function changeMonth(delta) { triggerHaptic(); currentDate.setMonth(currentDate.getMonth() + delta); updateMonthDisplay(); renderApp(); }
        function updateMonthDisplay() { let loc = 'he-IL'; if(translations[currentLang]) loc = translations[currentLang].locale; document.getElementById('current-month-display').innerText = currentDate.toLocaleDateString(loc, { month: 'long', year: 'numeric' }); }
        function openCategoryModal() { document.getElementById('cat-modal').classList.add('open'); }
        function closeCategoryModal() { document.getElementById('cat-modal').classList.remove('open'); }
        function selectEmoji(e) { document.getElementById('new-cat-emoji').value = e; }
        function confirmAddCategory() { const name = document.getElementById('new-cat-name').value; const limit = document.getElementById('new-cat-limit').value; const emoji = document.getElementById('new-cat-emoji').value || 'ğŸ“'; if(name) { appData.categories.push({ id: Date.now(), name, emoji, limit: parseFloat(limit)||1000, items: [] }); saveAndRender(); closeCategoryModal(); } }
        function openLimitModal(catId) { const cat = appData.categories.find(c => c.id === catId); document.getElementById('edit-cat-id').value = catId; document.getElementById('limit-modal-cat-name').innerText = cat.name; document.getElementById('edit-cat-limit').value = cat.limit; document.getElementById('limit-modal').classList.add('open'); }
        function confirmEditLimit() { const catId = parseInt(document.getElementById('edit-cat-id').value); const newLimit = parseFloat(document.getElementById('edit-cat-limit').value); const cat = appData.categories.find(c => c.id === catId); if(cat && newLimit) { cat.limit = newLimit; saveAndRender(); document.getElementById('limit-modal').classList.remove('open'); } }
        function toggleDarkMode() { document.body.classList.toggle('dark-mode'); localStorage.setItem('darkMode', document.body.classList.contains('dark-mode')); }
        function checkPremiumStatus() { if(appData.isPremium) { document.querySelectorAll('.ad-spacer').forEach(e=>e.style.display='none'); document.body.style.paddingBottom="80px"; } }
        
        function toggleRecType() { const isInstall = document.getElementById('type-installments').checked; document.getElementById('rec-payments-container').style.display = isInstall ? 'block' : 'none'; }
function renderRecurringPage() {
            const container = document.getElementById('recurring-list-container'); 
            container.innerHTML = ''; 
            
            const select = document.getElementById('rec-cat-select'); 
            if(select) select.innerHTML = appData.categories.map(c => `<option value="${c.id}">${c.emoji} ${c.name}</option>`).join(''); 
            
            if (!appData.recurringSettings || appData.recurringSettings.length === 0) { 
                container.innerHTML = `<tr><td colspan="4" style="text-align:center; padding:20px; color:#999;">${t('no_recur')}</td></tr>`; 
                return; 
            } 
            
            appData.recurringSettings.forEach((rec, index) => { 
                const cat = appData.categories.find(c => c.id == rec.catId); 
                const catName = cat ? (cat.emoji + ' ' + cat.name) : '-'; 
                
                let nameDisplay = rec.text;
                
                // === ×”×ª×™×§×•×Ÿ ×›××Ÿ ===
                if(rec.type === 'installments') {
                    // ×—×™×©×•×‘: ×¡×”"×› ×¤×—×•×ª ××” ×©× ×©××¨ = ×”×ª×©×œ×•× ×©×× ×—× ×• ××•×—×–×™× ×‘×•
                    // ×œ×“×•×’××”: 12 ×¤×—×•×ª 11 ×©× ×©××¨×• = ×ª×©×œ×•× 1
                    let currentNum = rec.totalPayments - rec.remaining;
                    // ×”×’× ×” ×§×˜× ×” ×œ××§×¨×” ×§×¦×” (×©×œ× ×™×¦×™×’ 0)
                    if (currentNum < 1) currentNum = 1;
                    
                    nameDisplay += ` <small style="color:var(--primary)">(${currentNum}/${rec.totalPayments})</small>`; 
                } else { 
                    nameDisplay += ` <small style="opacity:0.5">(âˆ)</small>`; 
                } 

                const tr = document.createElement('tr'); 
                tr.innerHTML = `<td style="font-weight:bold;">${nameDisplay}</td><td style="color:var(--text-sec); font-size:0.85rem;">${catName}</td><td style="text-align:center; direction:ltr;">${formatMoney(rec.amount)}</td><td style="text-align:center;"><button onclick="deleteRecurring(${index})" style="background:rgba(255, 118, 117, 0.1); color:var(--danger); border:none; width:30px; height:30px; border-radius:50%; cursor:pointer;"><i class="fas fa-trash-alt"></i></button></td>`; 
                container.appendChild(tr); 
            }); 
        }        function addRecurringSetting() { triggerHaptic(); const text = document.getElementById('rec-desc').value; const amount = parseFloat(document.getElementById('rec-amount').value); const catId = document.getElementById('rec-cat-select').value; const isInstallments = document.getElementById('type-installments').checked; const payments = parseInt(document.getElementById('rec-payments').value) || 1; if(!text || !amount) return; const uniqueRecurId = Date.now() + Math.random(); const setting = { id: uniqueRecurId, text, amount, catId, type: isInstallments ? 'installments' : 'fixed', totalPayments: isInstallments ? payments : 0, remaining: isInstallments ? payments : 0 }; appData.recurringSettings.push(setting); const cat = appData.categories.find(c => c.id == catId); if(cat) { let itemText = text + ' (Auto)'; if(isInstallments) { itemText = `${text} (1/${payments})`; setting.remaining--; } cat.items.push({ id: Date.now().toString(), text: itemText, amount: -Math.abs(amount), date: currentDate.toISOString(), isAuto: true, method: 'credit', fromRecurId: uniqueRecurId }); if(isInstallments && setting.remaining <= 0) { appData.recurringSettings = appData.recurringSettings.filter(r => r.id !== uniqueRecurId); } } saveAndRender(); document.getElementById('rec-desc').value = ''; document.getElementById('rec-amount').value = ''; document.getElementById('rec-payments').value = ''; renderRecurringPage(); showAppAlert(t('alert_title'), 'Synced', 'âœ…'); }
        function deleteRecurring(index) { triggerHaptic(); const s = appData.recurringSettings[index]; appData.recurringSettings.splice(index, 1); if(s.id) { appData.categories.forEach(cat => { cat.items = cat.items.filter(item => item.fromRecurId !== s.id); }); } saveData(); renderRecurringPage(); saveAndRender(); }
        function checkAndRunRecurring() { const now = new Date(); const mKey = `${now.getMonth()}-${now.getFullYear()}`; if(appData.lastProcessedMonth !== mKey) { if (appData.recurringSettings) { appData.recurringSettings.forEach(rec => { const cat = appData.categories.find(c => c.id == rec.catId); if(cat) { let itemText = rec.text; let shouldAdd = true; if(rec.type === 'installments') { if(rec.remaining > 0) { const currentP = (rec.totalPayments - rec.remaining) + 1; itemText = `${rec.text} (${currentP}/${rec.totalPayments})`; rec.remaining--; } else { shouldAdd = false; } } else { itemText += ' (Auto)'; } if(shouldAdd) { cat.items.push({ id: 'auto_'+Date.now()+Math.random(), text: itemText, amount: -Math.abs(rec.amount), date: now.toISOString(), isAuto: true, method:'credit' }); } } }); appData.recurringSettings = appData.recurringSettings.filter(rec => rec.type !== 'installments' || rec.remaining > 0); } appData.lastProcessedMonth = mKey; saveData(); } }
        function showAppAlert(title, message, icon = 'âœ…', callback = null) { document.getElementById('alert-title').innerText = title; document.getElementById('alert-message').innerText = message; document.getElementById('alert-icon').innerText = icon; postAlertAction = callback; document.getElementById('custom-alert-modal').classList.add('open'); }
        function closeCustomAlert() { document.getElementById('custom-alert-modal').classList.remove('open'); if (postAlertAction) { postAlertAction(); postAlertAction = null; } }
        function showConfirmDialog(title, msg, callback) { document.getElementById('gen-confirm-title').innerText = title; document.getElementById('gen-confirm-msg').innerText = msg; pendingAction = callback; document.getElementById('general-confirm-modal').classList.add('open'); }
        function closeGeneralConfirm() { document.getElementById('general-confirm-modal').classList.remove('open'); pendingAction = null; }
        function performGeneralConfirm() { if (pendingAction) pendingAction(); closeGeneralConfirm(); }

        function calcLoan() { triggerHaptic(); const amount = parseFloat(document.getElementById('loan-amount').value); const rate = parseFloat(document.getElementById('loan-rate').value); const years = parseFloat(document.getElementById('loan-years').value); if(amount && rate && years) { const r = rate / 100 / 12; const n = years * 12; const monthly = amount * r * Math.pow(1 + r, n) / (Math.pow(1 + r, n) - 1); document.getElementById('loan-result').innerText = formatMoney(monthly); } }
        function calcSplit() { triggerHaptic(); const amount = parseFloat(document.getElementById('split-amount').value); const tip = parseFloat(document.getElementById('split-tip').value); const people = parseFloat(document.getElementById('split-people').value); if(amount && people) { const total = amount * (1 + tip/100); const perPerson = total / people; document.getElementById('split-result').innerText = formatMoney(perPerson); } }
        function renderWishlist() { const container = document.getElementById('wishlist-container'); if(!container) return; container.innerHTML = ''; if(!appData.wishlist || appData.wishlist.length === 0) { container.innerHTML = `<div style="text-align:center; padding:20px; opacity:0.6;">${t('no_items')}</div>`; return; } appData.wishlist.forEach((item, index) => { const div = document.createElement('div'); div.className = 'wishlist-item animate-item'; div.innerHTML = `<div class="w-info"><div class="w-name">${item.name}</div><div class="w-price">${formatMoney(item.price)}</div></div><div class="w-actions"><button class="w-btn buy" onclick="openBuyItemModal(${index})"><i class="fas fa-check"></i></button><button class="w-btn del" onclick="deleteWishlistItem(${index})"><i class="fas fa-trash"></i></button></div>`; container.appendChild(div); }); }
        function addWishlistItem() { triggerHaptic(); const name = document.getElementById('wish-name').value; const price = parseFloat(document.getElementById('wish-price').value); if(name && price) { appData.wishlist.push({name, price}); saveData(); renderWishlist(); document.getElementById('wish-name').value = ''; document.getElementById('wish-price').value = ''; } }
        function deleteWishlistItem(index) { triggerHaptic(); appData.wishlist.splice(index, 1); saveData(); renderWishlist(); }
        function openBuyItemModal(index) { document.getElementById('buy-item-index').value = index; const select = document.getElementById('buy-cat-select'); select.innerHTML = appData.categories.map(c => `<option value="${c.id}">${c.emoji} ${c.name}</option>`).join(''); document.getElementById('buy-item-modal').classList.add('open'); }
        function confirmBuyItem() { triggerHaptic(); const index = parseInt(document.getElementById('buy-item-index').value); const catId = document.getElementById('buy-cat-select').value; const item = appData.wishlist[index]; const cat = appData.categories.find(c => c.id == catId); if(cat && item) { cat.items.push({ id: Date.now().toString(), text: item.name, amount: -Math.abs(item.price), date: currentDate.toISOString(), method: 'credit' }); appData.wishlist.splice(index, 1); saveAndRender(); renderWishlist(); document.getElementById('buy-item-modal').classList.remove('open'); showAppAlert(t('alert_title'), 'Purchased!', 'ğŸ›ï¸'); } }
        
        // SSC
        function initSalaryCalculator() {
            const $ = s => document.querySelector(s);
            const ymDefault = `${currentDate.getFullYear()}-${String(currentDate.getMonth()+1).padStart(2,'0')}`;
            const currentMode = localStorage.getItem('ssc:mode') || 'generic';
            const MISHMAR_CATS = [ {id:'m1', name:'×‘×•×§×¨', slices:[{p:100,h:8}]}, {id:'m2', name:'×¦×”×¨×™×™×', slices:[{p:120,h:8}]}, {id:'m3', name:'×œ×™×œ×”', slices:[{p:150,h:8}]}, {id:'m4', name:'×©×™×©×™ ×¦×”×¨×™×™×', slices:[{p:120,h:3},{p:250,h:5}]}, {id:'m5', name:'×©×™×©×™/×©×‘×ª ×œ×™×œ×”', slices:[{p:300,h:8}]}, {id:'m6', name:'×©×‘×ª ×‘×•×§×¨/×¦×”×¨×™×™×', slices:[{p:225,h:8}]}, {id:'m7', name:'×¨×¦×£ ×¦×”×¨×™×™× ×œ×‘×•×§×¨', slices:[{p:125,h:2},{p:150,h:6}]}, {id:'m8', name:'×¨×¦×£ ×œ×™×œ×” ×œ×¦×”×¨×™×™×', slices:[{p:187,h:2},{p:225,h:6}]}, {id:'m9', name:'×›×¤×•×œ×” 7-19', slices:[{p:100,h:8},{p:120,h:2},{p:150,h:2}]}, {id:'m10', name:'×›×¤×•×œ×” 8-20', slices:[{p:100,h:7},{p:125,h:3},{p:150,h:2}]}, {id:'m11', name:'×›×¤×•×œ×” 9-21', slices:[{p:100,h:6},{p:125,h:4},{p:150,h:2}]}, {id:'m12', name:'×—×“ ×™×•××™ (06-21)', slices:[{p:100,h:8},{p:125,h:2},{p:150,h:5}]} ];
            const state = { mode: currentMode, hourly: 0, ym: ymDefault, categories: [], counts: {}, quickRows: [] };
            const els = { hourly: $('#ssc_hourly'), month: $('#ssc_month'), grid: $('#ssc_grid'), tShifts: $('#ssc_totalShifts'), tHours: $('#ssc_totalHours'), gTotal: $('#ssc_grandTotal'), details: $('#ssc_details'), dTotal: $('#ssc_detailsTotal'), quick: $('#ssc_quickRows'), quickSum: $('#ssc_quickSum') };
            const badge = document.getElementById('ssc_modeBadge');
            if(state.mode === 'mishmar') { badge.innerText = "××¦×‘ ××©××¨ ğŸ‘®â€â™‚ï¸"; badge.style.background = "rgba(255, 215, 0, 0.3)"; document.getElementById('ssc_editorPanel').style.display = 'none'; } else { badge.innerText = t('mode_free'); badge.style.background = "rgba(255,255,255,0.2)"; document.getElementById('ssc_editorPanel').style.display = 'block'; }
            try{ const cfg=JSON.parse(localStorage.getItem('ssc:cfg')||'{}'); state.hourly=cfg.hourly||0; els.hourly.value=state.hourly||''; els.month.value=state.ym; }catch(e){}
            function loadData(){ if(state.mode === 'mishmar') { state.categories = MISHMAR_CATS; } else { try{state.categories=JSON.parse(localStorage.getItem('ssc:cats_generic')||'[]');}catch{state.categories=[];} if(!state.categories.length) state.categories=[{id:'g1',name:'××©××¨×ª ×¨×’×™×œ×”',slices:[{p:100,h:8}]}]; } localStorage.setItem('ssc:shared_categories', JSON.stringify(state.categories)); const storeKey=`ssc:counts:${state.mode}:${state.ym}`; try{state.counts=JSON.parse(localStorage.getItem(storeKey)||'{}');}catch{state.counts={};} const quickKey=`ssc:quick:${state.mode}:${state.ym}`; try{state.quickRows=JSON.parse(localStorage.getItem(quickKey)||'[]');}catch{state.quickRows=[];} }
            function saveData(){ localStorage.setItem('ssc:cfg', JSON.stringify({hourly:state.hourly})); localStorage.setItem(`ssc:counts:${state.mode}:${state.ym}`, JSON.stringify(state.counts)); localStorage.setItem(`ssc:quick:${state.mode}:${state.ym}`, JSON.stringify(state.quickRows)); if(state.mode==='generic') localStorage.setItem('ssc:cats_generic', JSON.stringify(state.categories)); }
            function renderAll(){ els.grid.innerHTML=''; if(!state.categories.length){ document.getElementById('ssc_emptyState').style.display='block'; return;} document.getElementById('ssc_emptyState').style.display='none'; state.categories.forEach(c=>{ const n=state.counts[c.id]||0; const subtotal=payForShift(c)*n; const card=document.createElement('div'); card.className='ssc-card animate-item'; const delBtn = state.mode === 'generic' ? `<button class="ssc-del-cat" onclick="sscDeleteCategory('${c.id}')"><i class="fas fa-times"></i></button>` : ''; card.innerHTML=`${delBtn}<h3>${c.name}</h3><div class="ssc-meta">${getShiftInfo(c).desc}</div><div class="ssc-counter"><div class="ssc-iconbtn" onclick="sscUpdateCount('${c.id}', -1)">âˆ’</div><div class="ssc-count">${n}</div><div class="ssc-iconbtn" onclick="sscUpdateCount('${c.id}', 1)">+</div></div><div class="ssc-meta" style="text-align:end">${t('col_total')}: <b>${fmt(subtotal)}</b></div>`; els.grid.appendChild(card); }); renderQuick(); calcAndRenderTotals(); }
            function renderQuick(){ els.quick.innerHTML=''; state.quickRows.forEach((r,i)=>{ const div=document.createElement('div'); div.className='ssc-editor-slice'; div.innerHTML=`<input type="text" class="ssc-inp" value="${r.label||''}" onchange="sscUpdateQuick(${i}, 'label', this.value)" placeholder="${t('col_desc')}" style="flex:2"><input type="number" class="ssc-inp" value="${r.h}" step="0.5" onchange="sscUpdateQuick(${i}, 'h', this.value)" placeholder="${t('col_hours')}" style="flex:1;text-align:center"><input type="number" class="ssc-inp" value="${r.p}" onchange="sscUpdateQuick(${i}, 'p', this.value)" placeholder="${t('col_percent')}" style="flex:1;text-align:center"><button class="ssc-btn-close-slice" onclick="this.parentElement.remove()" style="margin-top:15px"><i class="fas fa-times"></i></button>`; els.quick.appendChild(div); }); }
            function calcAndRenderTotals(){ let shifts=0, hours=0, money=0; let tbodyHtml=''; state.categories.forEach(c=>{ const n=state.counts[c.id]||0; if(n>0){ const info=getShiftInfo(c); const subMoney=payForShift(c)*n; const subHours=info.totalHours*n; shifts+=n; hours+=subHours; money+=subMoney; tbodyHtml+=`<tr><td style="text-align:start">${c.name}</td><td>${n}</td><td>${subHours}</td><td>${fmt(subMoney)}</td></tr>`; } }); let qMoney=0; state.quickRows.forEach(r=>{ qMoney+=(state.hourly*(r.p/100)*r.h); }); if(qMoney>0||state.quickRows.length>0){ money+=qMoney; tbodyHtml+=`<tr><td colspan="3" style="text-align:start">${t('free_calc_title')}</td><td>${fmt(qMoney)}</td></tr>`; } els.tShifts.textContent=shifts; els.tHours.textContent=parseFloat(hours.toFixed(2)); els.gTotal.textContent=fmt(money); els.details.innerHTML=tbodyHtml; els.dTotal.textContent=fmt(money); els.quickSum.textContent=fmt(qMoney); }
            function getShiftInfo(c){ let h=0; const parts=c.slices.map(s=>{ h+=+s.h; return `${s.p}%Ã—${s.h}h`; }); return {totalHours:h, desc:`${h}h (${parts.join(' + ')})`}; }
            function payForShift(c){ if(!state.hourly)return 0; return c.slices.reduce((sum,s)=>sum+(state.hourly*(s.p/100)*s.h),0); }
            function fmt(n){ return formatMoney(n); }
            loadData(); renderAll();
            window.sscUpdateCount=(id,delta)=>{ triggerHaptic(); state.counts[id]=Math.max(0,(state.counts[id]||0)+delta); saveData(); renderAll(); };
            window.sscDeleteCategory=(id)=>{ triggerHaptic(); if(!confirm('Delete?'))return; state.categories=state.categories.filter(c=>c.id!==id); delete state.counts[id]; saveData(); renderAll(); };
            window.sscUpdateQuick=(i,k,v)=>{ state.quickRows[i][k]=(k==='label')?v:+v; saveData(); renderAll(); };
            window.sscRemoveQuick=(i)=>{ state.quickRows.splice(i,1); saveData(); renderAll(); };
            window.sscAddQuickRow = () => { triggerHaptic(); state.quickRows.push({h:0, p:100, label:''}); saveData(); renderQuick(); };
            window.sscResetMonth = () => { document.getElementById('reset-confirm-modal').classList.add('open'); };
            window.performRealReset = () => { state.counts={}; state.quickRows=[]; saveData(); renderAll(); document.getElementById('reset-confirm-modal').classList.remove('open'); };
            window.sscAddEditorSlice = () => { const d=document.createElement('div'); d.className='ssc-editor-slice'; d.innerHTML=`<div style="flex:1"><span style="font-size:10px">%</span><input type="number" class="ssc-inp e-p" value="100"></div><div style="flex:1"><span style="font-size:10px">H</span><input type="number" class="ssc-inp e-h" value="8" step="0.5"></div><button class="ssc-btn-close-slice" onclick="this.parentElement.remove()" style="margin-top:15px"><i class="fas fa-times"></i></button>`; $('#ssc_newShiftSlices').appendChild(d); };
            els.hourly.oninput=()=>{ state.hourly=+els.hourly.value; saveData(); renderAll(); };
            els.month.onchange=()=>{ state.ym=els.month.value; loadData(); renderAll(); };
            $('#ssc_saveTemplateBtn').onclick=()=>{ const name=$('#ssc_newShiftName').value.trim(); const slices=[]; document.querySelectorAll('#ssc_newShiftSlices .ssc-editor-slice').forEach(div=>{ slices.push({p:+div.querySelector('.e-p').value, h:+div.querySelector('.e-h').value}); }); if(name && slices.length){ state.categories.push({id:'g'+Date.now(),name,slices}); saveData(); renderAll(); $('#ssc_newShiftName').value=''; $('#ssc_newShiftSlices').innerHTML=''; window.sscAddEditorSlice(); } };
        }

        document.addEventListener('click', function(e) {
            if (e.target && e.target.id === 'ssc_secretBtn') {
                const input = document.getElementById('ssc_secretCode');
                if (!input) return;
                const val = input.value.trim();
                if (val === '××©××¨') { localStorage.setItem('ssc:mode', 'mishmar'); showAppAlert('××¦×‘ ××©××¨', '×”×¤×¨×•×¤×™×œ × ×˜×¢×Ÿ ×‘×”×¦×œ×—×”! ××¨×¢× ×Ÿ...', 'ğŸ‘®â€â™‚ï¸', function() { location.reload(); }); } 
                else if (val === '×¨×’×™×œ' || val === 'generic') { localStorage.setItem('ssc:mode', 'generic'); showAppAlert('××¦×‘ ×¨×’×™×œ', '×—×–×¨×ª ×œ××¦×‘ ×¢×¨×™×›×” ×—×•×¤×©×™.', 'âœï¸', function() { location.reload(); }); } 
                else { showAppAlert('×©×’×™××”', '×§×•×“ ×œ× ×—×•×§×™', 'âŒ'); }
            }
        });
    </script>
</body>
</html>


